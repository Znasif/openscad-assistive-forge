<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="description" content="Web-based OpenSCAD customizer - customize and generate 3D printable STL files directly in your browser" />
    <title>OpenSCAD Assistive Forge</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Theme colors -->
    <meta name="theme-color" content="#f4c400" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0b0b0b" media="(prefers-color-scheme: dark)" />
    
    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="OpenSCAD Assistive Forge" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    
    <!-- Microsoft -->
    <meta name="msapplication-TileColor" content="#f4c400" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
  </head>
  <body>
    <!-- Skip to content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div id="app">
      <header class="app-header">
        <div class="header-content">
          <div class="header-branding">
            <img
              class="header-logo"
              src="/icons/logo.png"
              alt="OpenSCAD Assistive Web Forge logo"
              width="44"
            />
            <div class="header-branding-text">
              <h1>
                <span class="title-full">OpenSCAD Assistive Forge</span>
                <span class="title-short" aria-hidden="true">OpenSCAD AF</span>
              </h1>
              <p class="app-tagline">Customize 3D models directly in your browser</p>
            </div>
          </div>
          <div class="header-controls">
            <a href="https://github.com/BrennenJohnston/openscad-assistive-forge" 
               class="btn btn-sm btn-secondary github-link" 
               target="_blank" 
               rel="noopener noreferrer" 
               aria-label="View source code on GitHub (opens in new tab)" 
               title="View on GitHub">
              <svg class="github-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
              </svg>
              <span class="github-label">GitHub</span>
            </a>
            <button id="contrastToggle" class="btn btn-sm btn-secondary contrast-toggle" aria-label="Toggle high contrast" title="Toggle high contrast mode" data-tutorial-target="contrast-toggle">
              <svg class="contrast-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 2 L12 22"></path>
                <path d="M12 2 A10 10 0 0 1 12 22" fill="currentColor" opacity="0.5"></path>
              </svg>
              <span class="contrast-label">HC</span>
            </button>
            <button id="themeToggle" class="btn btn-sm btn-secondary theme-toggle" aria-label="Toggle theme" title="Toggle light/dark theme" data-tutorial-target="theme-toggle">
              <svg class="theme-icon theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg class="theme-icon theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
              </svg>
            </button>
          </div>
        </div>
      </header>

      <div
        id="updateBanner"
        class="update-banner hidden"
        role="region"
        aria-live="polite"
        aria-label="Update available"
      >
        <div class="update-banner-content">
          <span class="update-banner-text">Update available. Refresh to get the latest version.</span>
          <div class="update-banner-actions">
            <button id="updateBannerRefresh" class="btn btn-sm btn-primary">
              Refresh
            </button>
            <button id="updateBannerDismiss" class="btn btn-sm btn-secondary">
              Dismiss
            </button>
          </div>
        </div>
      </div>
      
      <!-- Workflow Progress Indicator (C3: COGA breadcrumbs) - Moved here to prevent header overlap -->
      <div class="workflow-progress hidden" id="workflowProgress" role="navigation" aria-label="Workflow progress">
        <ol class="workflow-steps">
          <li class="workflow-step" data-step="upload" aria-current="false">
            <span class="workflow-step-number">1</span>
            <span class="workflow-step-label">Upload</span>
          </li>
          <li class="workflow-step" data-step="customize" aria-current="false">
            <span class="workflow-step-number">2</span>
            <span class="workflow-step-label">Customize</span>
          </li>
          <li class="workflow-step" data-step="render" aria-current="false">
            <span class="workflow-step-number">3</span>
            <span class="workflow-step-label">Generate</span>
          </li>
          <li class="workflow-step" data-step="download" aria-current="false">
            <span class="workflow-step-number">4</span>
            <span class="workflow-step-label">Download</span>
          </li>
        </ol>
        <div class="workflow-actions">
          <button id="focusModeBtn" class="btn btn-sm btn-outline" aria-pressed="false" aria-label="Enter focus mode" title="Focus mode (maximize preview)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
            <span class="btn-text">Full Screen</span>
          </button>
          <button id="featuresGuideBtn" class="btn btn-sm btn-outline btn-with-icon" aria-label="Open features guide and examples" title="Help & Examples" data-tutorial-target="features-guide">
            <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter" aria-hidden="true">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="11" x2="12" y2="16"></line>
              <circle cx="12" cy="7.5" r="1" fill="currentColor" stroke="none"></circle>
            </svg>
            <span class="btn-text">Help</span>
          </button>
          <button id="clearFileBtn" class="btn btn-sm btn-outline" aria-label="Go back to welcome screen. Warning: unsaved changes will be lost" title="Back to welcome screen (unsaved changes will be lost)" data-tutorial-target="clear-file">
            ‚Üê Back
          </button>
        </div>
      </div>
      
      <main class="app-main" id="main-content" tabindex="-1">
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-content">
            <h2>Get Started</h2>
            <p>Upload an OpenSCAD (.scad) file to customize its parameters and generate STL files</p>
            
            <label class="upload-zone" id="uploadZone" for="fileInput" tabindex="0">
              <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <span class="upload-text">Drop .scad or .zip file here or click to browse</span>
              <input type="file" id="fileInput" accept=".scad,.zip" class="file-input" />
            </label>
            
              <div class="features-overview" role="region" aria-labelledby="features-heading">
              <h3 id="features-heading">Discover features (optional)</h3>
                <p class="features-intro">Take a quick guided start, or open Help to browse workflow tips, libraries, presets, and accessibility options.</p>
              
              <div class="role-paths-grid">
                <!-- Beginners Start Here (only visible tutorial for now) -->
                <div class="role-path-card">
                  <h4 class="role-path-title">Beginners Start Here</h4>
                  <p class="role-path-meta">Guided tour ‚Ä¢ about 3 minutes</p>
                  <p class="role-path-description">Load a simple example, change a few parameters, and generate your first file.</p>
                  <details class="role-path-details">
                    <summary>What you‚Äôll learn</summary>
                    <ul class="role-path-tips" aria-label="What you'll learn">
                      <li>Where parameters live and how Preview updates</li>
                      <li>Presets and key actions (Generate / Download)</li>
                      <li>Camera controls and keyboard basics</li>
                    </ul>
                  </details>
                  <div class="role-path-actions">
                      <button class="btn btn-primary btn-role-try" data-example="simple-box" data-role="beginners" data-tutorial="intro">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-feature-tab="workflow" aria-label="Open Help: Workflow">
                      Open Help
                    </button>
                  </div>
                </div>

                <div class="role-path-card">
                  <h4 class="role-path-title">Explore Features</h4>
                  <p class="role-path-description">Prefer to browse? Open Help for examples and deeper guidance.</p>
                  <details class="role-path-details">
                    <summary>Common tasks</summary>
                    <ul class="role-path-tips" aria-label="Common tasks">
                      <li>Enable libraries and resolve dependencies</li>
                      <li>Save and reuse presets for repeatable settings</li>
                      <li>Export files and work with ZIP projects</li>
                    </ul>
                  </details>
                  <div class="role-path-actions">
                    <button class="btn btn-outline btn-role-learn" data-feature-tab="libraries" aria-label="Open Help: Libraries">
                      Open Help & Examples
                    </button>
                  </div>
                </div>

                <!-- Other tutorials are temporarily hidden (we'll re-enable later) -->
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Advanced Makers</h4>
                  <p class="role-path-description">Work with multi-file projects, libraries, and advanced OpenSCAD features</p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Upload ZIP files with dependencies</li>
                    <li>Enable MCAD, BOSL2, and other libraries</li>
                    <li>Export in multiple formats (STL, OBJ, 3MF)</li>
                  </ul>
                  <div class="role-path-actions">
                    <button class="btn btn-primary btn-role-try" data-example="library-test" data-role="makers" data-tutorial="makers">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-feature-tab="libraries" aria-label="Open Features Guide: Libraries">
                      Learn More
                    </button>
                  </div>
                </div>

                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Keyboard-Only Users</h4>
                  <p class="role-path-description">Complete the full workflow without a mouse using predictable keyboard controls</p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Tab through parameters logically</li>
                    <li>Undo/Redo with Ctrl+Z / Ctrl+Shift+Z</li>
                    <li>Skip to main content (screen top)</li>
                  </ul>
                  <div class="role-path-actions">
                    <button class="btn btn-primary btn-role-try" data-example="cylinder" data-role="keyboard-only" data-tutorial="keyboard-only">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-doc="KEYGUARD_WORKFLOW_GUIDE" aria-label="Learn about keyboard navigation">
                      Learn More
                    </button>
                  </div>
                </div>

                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Low Vision Users</h4>
                  <p class="role-path-description">Use high contrast themes, large touch targets, and visible focus indicators</p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Toggle HC button (high contrast mode)</li>
                    <li>Switch light/dark theme</li>
                    <li>All buttons meet 44√ó44px touch target</li>
                  </ul>
                  <div class="role-path-actions">
                    <button class="btn btn-primary btn-role-try" data-example="simple-box" data-role="low-vision" data-tutorial="low-vision">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility" aria-label="Learn about visual accessibility features">
                      Learn More
                    </button>
                  </div>
                </div>

                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Voice Input Users</h4>
                  <p class="role-path-description">Control the app with voice commands using stable, speakable names</p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Say button labels: "Click Generate STL"</li>
                    <li>Navigate: "Click Help", "Click Reset"</li>
                    <li>All controls have unique, speakable names</li>
                  </ul>
                  <div class="role-path-actions">
                    <button class="btn btn-primary btn-role-try" data-example="simple-box" data-role="voice-input" data-tutorial="voice-input">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility" aria-label="Learn about voice input and accessible control names">
                      Learn More
                    </button>
                  </div>
                </div>

                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Screen Reader Users</h4>
                  <p class="role-path-description">Customize models with clear status announcements and keyboard-only workflow</p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Status area announces all changes</li>
                    <li>ARIA landmarks for quick navigation</li>
                    <li>Plain-language error messages</li>
                  </ul>
                  <div class="role-path-actions">
                    <button class="btn btn-primary btn-role-try" data-example="simple-box" data-role="screen-reader" data-tutorial="screen-reader">
                      Start Tutorial
                    </button>
                    <button class="btn btn-link btn-role-learn" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility" aria-label="Learn about screen reader accessibility features">
                      Learn More
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Accessibility Spotlights -->
              <details class="accessibility-spotlights" id="accessibilitySpotlights">
                <summary class="spotlights-summary">
                  <span class="spotlights-summary-title">Accessibility Highlights</span>
                  <span class="sr-only">Expand to learn more about accessibility features</span>
                </summary>
                <div class="spotlights-body" role="group" aria-label="Accessibility highlights details">
                  <p class="spotlights-intro">
                    Built around accessibility patterns commonly seen in open source tools like VS Code and JupyterLab:
                    predictable keyboard navigation, strong focus visibility, and clear status messaging.
                  </p>
                  <ul class="spotlights-list" aria-label="Accessibility highlights">
                    <li>
                      <a href="#" class="spotlight-link" data-doc="KEYGUARD_WORKFLOW_GUIDE" data-feature-tab="accessibility">
                        <span class="spotlight-title">Keyboard-first workflow (no required drag gestures)</span>
                        <span class="spotlight-detail">
                          Tab through controls, activate with Enter/Space, and adjust sliders/number fields without dragging.
                          Step-by-step workflow guidance is available.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a href="#" class="spotlight-link" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility">
                        <span class="spotlight-title">High contrast, dark mode, and Windows forced-colors support</span>
                        <span class="spotlight-detail">
                          Theme controls plus OS-enforced contrast modes keep borders, focus rings, and text readable.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a href="#" class="spotlight-link" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility">
                        <span class="spotlight-title">Screen reader-friendly status updates and focus-safe dialogs</span>
                        <span class="spotlight-detail">
                          Key actions announce status changes, and dialogs use focus trapping + focus restoration.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a href="#" class="spotlight-link" data-doc="ACCESSIBILITY_GUIDE" data-feature-tab="accessibility">
                        <span class="spotlight-title">Plain-language errors and guidance (not cryptic console logs)</span>
                        <span class="spotlight-detail">
                          Errors are translated into actionable messages so you can recover quickly.
                        </span>
                      </a>
                    </li>
                  </ul>
                </div>
              </details>
              
              <!-- Storage Panel -->
              <section class="storage-panel" aria-labelledby="storage-heading">
                <h3 id="storage-heading">Storage Usage</h3>
                <p class="storage-description">Persistent storage for cached files, presets, and settings</p>
                <div class="storage-meter" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Storage usage percentage">
                  <div class="storage-meter-fill"></div>
                </div>
                <div class="storage-info">
                  <span id="storage-used">-- used</span>
                </div>
                <button type="button" class="btn btn-secondary" id="clearStorageBtn" aria-describedby="storage-heading">
                  Clear Cache
                </button>
                <p class="storage-not-supported hidden" id="storageNotSupported">
                  Storage information not available in this browser.
                </p>
              </section>
              
            </div>
          </div>
        </div>
        
        <div class="main-interface hidden" id="mainInterface">
          <div class="param-panel" id="paramPanel" role="region" aria-label="Model parameters">
            <!-- WCAG 2.2 SC 3.2.6 Consistent Help: Help mechanisms (Features Guide button) 
                 appear in consistent relative order across panels (top-right area) -->
            <div class="panel-header">
              <h2 id="parameters-heading">Parameters</h2>
              
              <!-- Mobile close button for drawer -->
              <button 
                id="drawerCloseBtn" 
                class="btn btn-sm btn-icon mobile-only drawer-close-btn" 
                aria-label="Close parameters panel"
                title="Close"
                style="display: none;"
                data-tutorial-target="mobile-drawer-close"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
              
              <div class="param-header-actions">
                <button id="undoBtn" class="btn btn-sm btn-outline btn-with-icon" aria-label="Undo last parameter change (Ctrl+Z)" title="Undo (Ctrl+Z)" disabled>
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter" aria-hidden="true">
                    <polyline points="9 14 4 9 9 4"></polyline>
                    <path d="M20 20v-7a4 4 0 0 0-4-4H4"></path>
                  </svg>
                  <span class="btn-text">Undo</span>
                </button>
                <button id="redoBtn" class="btn btn-sm btn-outline btn-with-icon" aria-label="Redo parameter change (Ctrl+Shift+Z)" title="Redo (Ctrl+Shift+Z)" disabled>
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter" aria-hidden="true">
                    <polyline points="15 14 20 9 15 4"></polyline>
                    <path d="M4 20v-7a4 4 0 0 1 4-4h12"></path>
                  </svg>
                  <span class="btn-text">Redo</span>
                </button>
                <button id="resetBtn" class="btn btn-sm" aria-label="Reset all parameters to default values">Reset</button>
              </div>
              <!-- Panel collapse control - positioned at right edge for discoverability -->
              <div class="panel-collapse-control">
                <button 
                  id="collapseParamPanelBtn" 
                  class="btn btn-sm btn-icon btn-collapse-panel" 
                  aria-expanded="true" 
                  aria-controls="paramPanelBody" 
                  aria-label="Collapse parameters panel"
                  title="Collapse panel"
                  data-tutorial-target="collapse-param-panel"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <polyline points="11 18 5 12 11 6"></polyline>
                    <line x1="17" y1="4" x2="17" y2="20" stroke-width="2"></line>
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="param-panel-body" id="paramPanelBody">
            <!-- Preset Controls (Collapsed by default on desktop) -->
            <details class="preset-controls" id="presetControls" role="region" aria-label="Parameter presets" data-tutorial-target="preset-controls">
              <summary class="preset-summary">
                <span class="preset-icon" aria-hidden="true">
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter">
                    <rect x="4" y="4" width="16" height="16" rx="0"></rect>
                    <rect x="7" y="4" width="10" height="6" rx="0"></rect>
                    <rect x="8" y="14" width="8" height="6" rx="0"></rect>
                    <line x1="16" y1="7" x2="16" y2="9"></line>
                  </svg>
                </span>
                Presets
              </summary>
              <div class="preset-content">
                <div class="preset-actions">
                  <button id="savePresetBtn" class="btn btn-sm btn-outline" aria-label="Save current parameters as preset" title="Save current parameters">
                    üíæ Save Preset
                  </button>
                  <button id="managePresetsBtn" class="btn btn-sm btn-outline" aria-label="Manage presets" title="Manage saved presets">
                    üìã Manage
                  </button>
                </div>
                <div class="preset-selector" id="presetSelector">
                  <label for="presetSelect" class="preset-label">Load Preset:</label>
                  <select id="presetSelect" class="preset-select" aria-label="Select a saved preset to load">
                    <option value="">-- Select Preset --</option>
                  </select>
                </div>
              </div>
            </details>
            
            <!-- Library Controls -->
            <div class="library-controls hidden" id="libraryControls" role="region" aria-label="OpenSCAD library bundles" data-tutorial-target="library-controls">
              <details class="library-details">
                <summary class="library-summary">
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter" aria-hidden="true">
                    <rect x="4" y="4" width="16" height="5" rx="0"></rect>
                    <rect x="4" y="10" width="16" height="5" rx="0"></rect>
                    <rect x="4" y="16" width="16" height="4" rx="0"></rect>
                  </svg>
                  Libraries <span class="library-badge" id="libraryBadge">0</span>
                </summary>
                <div class="library-content">
                  <p class="library-help">Enable libraries used by this model:</p>
                  <div class="library-list" id="libraryList">
                    <!-- Library checkboxes will be dynamically generated here -->
                  </div>
                  <div class="library-footer">
                    <button id="libraryHelpBtn" class="btn-link btn-link-with-icon" aria-label="Learn more about libraries">
                      <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter" aria-hidden="true">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="11" x2="12" y2="16"></line>
                        <circle cx="12" cy="7.5" r="1" fill="currentColor" stroke="none"></circle>
                      </svg>
                      What are libraries?
                    </button>
                  </div>
                </div>
              </details>
            </div>
            
            <!-- Parameter Search and Navigation (C2: Cognitive load reduction) -->
            <div class="param-search-section" id="paramSearchSection">
              <div class="param-search-row">
                <div class="param-search-input-wrapper">
                  <label for="paramSearchInput" class="sr-only">Search parameters</label>
                  <input type="search" id="paramSearchInput" class="param-search-input" placeholder="Search parameters..." aria-label="Search parameters by name or description" autocomplete="off" />
                  <button type="button" id="clearParamSearchBtn" class="param-search-clear hidden" aria-label="Clear search">√ó</button>
                </div>
                <div class="param-jump-wrapper">
                  <label for="paramJumpSelect" class="sr-only">Jump to group</label>
                  <select id="paramJumpSelect" class="param-jump-select" aria-label="Jump to parameter group">
                    <option value="">Jump to group...</option>
                  </select>
                </div>
              </div>
              <div class="param-filter-stats hidden" id="paramFilterStats" aria-live="polite">
                <span id="paramFilterCount">0</span> parameters shown
                <button type="button" id="showAllParamsBtn" class="btn-link">Show all</button>
              </div>
            </div>
            
            <div id="parametersContainer" class="parameters-container" aria-labelledby="parameters-heading" data-tutorial-target="parameters-container">
              <!-- Parameters will be dynamically generated here -->
            </div>
            
            <!-- Output Format Selector -->
            <div class="output-format-section" aria-label="Output format selection">
              <label for="outputFormat" class="output-format-label">Output:</label>
              <select id="outputFormat" class="output-format-select" aria-label="Select output file format" data-tutorial-target="output-format">
                <option value="stl" selected>STL</option>
                <option value="obj">OBJ</option>
                <option value="off">OFF</option>
                <option value="amf">AMF</option>
                <option value="3mf">3MF</option>
              </select>
              <span class="output-format-info" id="formatInfo" aria-live="polite">
                Most common format for 3D printing
              </span>
            </div>
            
            <!-- Advanced Menu -->
            <details class="advanced-menu" id="advancedMenu">
              <summary class="advanced-menu-summary">
                <span class="advanced-icon" aria-hidden="true">
                  <svg class="btn-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter">
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                    <rect x="8" y="4" width="4" height="4" rx="0"></rect>
                    <rect x="12" y="10" width="4" height="4" rx="0"></rect>
                    <rect x="6" y="16" width="4" height="4" rx="0"></rect>
                  </svg>
                </span>
                Advanced
              </summary>
              <div class="advanced-menu-content">
                <!-- View SCAD Source -->
                <div class="advanced-section">
                  <button id="viewSourceBtn" class="btn btn-sm btn-outline advanced-btn" aria-label="View OpenSCAD source code">
                    üìÑ View Source
                  </button>
                  <button id="copySourceBtn" class="btn btn-sm btn-outline advanced-btn" aria-label="Copy source code to clipboard">
                    üìã Copy Source
                  </button>
                </div>
                
                <!-- Parameter Limits Override -->
                <div class="advanced-section">
                  <label class="advanced-toggle">
                    <input type="checkbox" id="unlockLimitsToggle" />
                    <span>üîì Unlock Parameter Limits</span>
                  </label>
                  <p class="advanced-hint">Allow values outside parsed min/max ranges</p>
                </div>
                
                <!-- Reset Tools -->
                <div class="advanced-section">
                  <h4 class="advanced-section-title">Reset Tools</h4>
                  <div class="reset-tools">
                    <button id="resetAllBtn" class="btn btn-sm btn-outline" aria-label="Reset all parameters to defaults">
                      ‚Ü©Ô∏è Reset All
                    </button>
                    <button id="resetGroupBtn" class="btn btn-sm btn-outline" aria-label="Reset current group to defaults">
                      üìÅ Reset Group
                    </button>
                  </div>
                  <div class="reset-group-selector hidden" id="resetGroupSelector">
                    <label for="resetGroupSelect">Select group:</label>
                    <select id="resetGroupSelect" class="reset-group-select">
                      <!-- Groups will be populated dynamically -->
                    </select>
                    <button id="confirmResetGroupBtn" class="btn btn-sm btn-primary">Reset</button>
                  </div>
                </div>
                
                <!-- Raw Parameter JSON -->
                <div class="advanced-section">
                  <button id="viewParamsJsonBtn" class="btn btn-sm btn-outline advanced-btn" aria-label="View current parameters as JSON">
                    { } View Params JSON
                  </button>
                </div>
              </div>
            </details>
            </div>
          </div>
          
          <div class="preview-panel" id="previewPanel" role="region" aria-label="3D preview and actions">
            <!-- Scrollable content wrapper with vertical split -->
            <div class="preview-content" id="previewContent">
              <!-- Top section: Preview settings, status, stats, dimensions -->
              <div class="preview-info-section" id="previewInfoSection">
                <!-- Drawer toggle header with mobile params button -->
                <div class="preview-drawer-header">
                  <div class="preview-drawer-header-left">
                    <!-- Parameters button FIRST (left position) -->
                    <button 
                      id="mobileDrawerToggle" 
                      class="btn btn-sm btn-icon mobile-only" 
                      aria-expanded="false" 
                      aria-controls="paramPanel"
                      aria-label="Open parameters panel"
                      title="Parameters"
                      data-tutorial-target="mobile-drawer-toggle"
                    >
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                      </svg>
                      <span class="btn-label">Params</span>
                    </button>
                    
                    <!-- Preview Settings button SECOND (right of Parameters) -->
                    <button 
                      id="previewDrawerToggle" 
                      class="btn btn-sm btn-icon btn-collapse-panel preview-drawer-toggle-btn" 
                      aria-expanded="false" 
                      aria-controls="previewInfoContent"
                      aria-label="Expand preview settings and model info"
                      title="Preview Settings &amp; Info"
                      data-tutorial-target="preview-drawer-toggle"
                    >
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <polyline points="13 6 7 12 13 18"></polyline>
                        <line x1="17" y1="4" x2="17" y2="20" stroke-width="2"></line>
                      </svg>
                    </button>
                    <h2 class="preview-drawer-title" id="preview-settings-heading">Preview Settings &amp; Info</h2>
                  </div>

                  <div class="preview-drawer-header-right">
                    <!-- Empty or future controls -->
                  </div>
                </div>
                
                <!-- Collapsible content -->
                <div class="preview-info-content" id="previewInfoContent">
                  <!-- File info section -->
                  <div class="file-info" id="fileInfo" aria-live="polite">
                    <span class="file-info-summary" id="fileInfoSummary"></span>
                    <details class="file-info-details hidden" id="fileInfoDetails">
                      <summary>Show included files</summary>
                      <div class="file-info-tree" id="fileInfoTree"></div>
                    </details>
                  </div>
                  
                  <div class="status-area" id="statusArea" role="region" aria-label="Status">
                    Ready
                  </div>
                  <!-- Dedicated screen reader announcer (separate from visible status) -->
                  <div id="srAnnouncer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

                  <div class="preview-settings-panel" aria-label="Preview settings">
                    <div class="preview-settings-header">
                      <span class="settings-icon" aria-hidden="true">
                        <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter">
                          <line x1="4" y1="6" x2="20" y2="6"></line>
                          <line x1="4" y1="12" x2="20" y2="12"></line>
                          <line x1="4" y1="18" x2="20" y2="18"></line>
                          <rect x="8" y="4" width="4" height="4" rx="0"></rect>
                          <rect x="12" y="10" width="4" height="4" rx="0"></rect>
                          <rect x="6" y="16" width="4" height="4" rx="0"></rect>
                        </svg>
                      </span>
                      <span>Preview Settings</span>
                    </div>
                    <div class="preview-settings">
                      <label class="preview-setting">
                        <input type="checkbox" id="autoPreviewToggle" checked />
                        <span>Auto-preview</span>
                      </label>
                      
                      <label class="preview-setting">
                        <input type="checkbox" id="measurementsToggle" aria-describedby="measurementsHelp" />
                        <span>Show measurements</span>
                      </label>
                      <span id="measurementsHelp" class="sr-only">Toggle dimension measurements and bounding box overlay on 3D preview</span>

                      <label class="preview-setting">
                        <input type="checkbox" id="gridToggle" checked aria-describedby="gridHelp" />
                        <span>Show grid</span>
                      </label>
                      <span id="gridHelp" class="sr-only">Toggle grid plane visibility in 3D preview</span>

                      <label class="preview-setting">
                        <input type="checkbox" id="autoBedToggle" checked aria-describedby="autoBedHelp" />
                        <span>Auto-bed (Z=0)</span>
                      </label>
                      <span id="autoBedHelp" class="sr-only">Automatically place models on the build plate at Z equals zero</span>

                      <label class="preview-setting">
                        <input type="checkbox" id="statusBarToggle" checked aria-describedby="statusBarHelp" />
                        <span>Show status bar</span>
                      </label>
                      <span id="statusBarHelp" class="sr-only">Toggle status and render info overlay on preview</span>

                      <label class="preview-setting" for="previewQualitySelect">
                        <span class="preview-setting-label">Preview quality</span>
                        <select id="previewQualitySelect" aria-label="Select preview quality">
                          <option value="auto">Auto (adaptive)</option>
                          <option value="fidelity">Fidelity (slower)</option>
                          <option value="balanced" selected>Balanced (~50%)</option>
                          <option value="fast">Fast (lower resolution)</option>
                        </select>
                      </label>

                      <label class="preview-setting" for="exportQualitySelect">
                        <span class="preview-setting-label">Export quality</span>
                        <select id="exportQualitySelect" aria-label="Select export quality">
                          <option value="model" selected>Model default</option>
                          <option value="low">Low (fast)</option>
                          <option value="medium">Medium (balanced)</option>
                          <option value="high">High (smooth)</option>
                        </select>
                      </label>

                      <div class="preview-setting cache-tools">
                        <span class="preview-setting-label">App cache</span>
                        <button
                          id="clearCacheBtn"
                          class="btn btn-sm btn-outline"
                          aria-label="Clear cached files and reload the app"
                        >
                          Clear cache &amp; reload
                        </button>
                      </div>
                      
                      <div class="preview-setting complexity-indicator" id="complexityIndicator" title="Detected model complexity tier">
                        <span class="preview-setting-label">Complexity:</span>
                        <span id="complexityTierLabel" class="complexity-tier-label">Analyzing...</span>
                      </div>

                      <div class="preview-setting model-color-setting">
                        <span class="preview-setting-label">Model Color</span>
                        <div class="model-color-picker">
                          <input type="color" id="modelColorPicker" value="#2196F3" aria-label="Choose model display color" />
                          <button id="modelColorReset" class="btn-icon" title="Reset to theme default" aria-label="Reset color to theme default">‚Ü∫</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="stats" id="stats" role="status" aria-live="polite"></div>
                  
                  <div class="dimensions-display hidden" id="dimensionsDisplay" role="region" aria-label="Model dimensions">
                    <h3 class="dimensions-heading">Dimensions</h3>
                    <dl class="dimensions-list">
                      <div class="dimension-item">
                        <dt>Width (X):</dt>
                        <dd id="dimX">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Depth (Y):</dt>
                        <dd id="dimY">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Height (Z):</dt>
                        <dd id="dimZ">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Volume:</dt>
                        <dd id="dimVolume">--</dd>
                      </div>
                    </dl>
                  </div>
                </div>
              </div>
              
              <!-- Bottom section: 3D preview canvas -->
              <div class="preview-canvas-section" id="previewCanvasSection">
                <div class="preview-container" id="previewContainer" role="group" aria-label="3D model preview and controls" aria-describedby="previewModelSummary" tabindex="0" data-tutorial-target="preview-container">
                  <!-- 3D preview or placeholder -->
                  <div class="preview-placeholder">
                    <p>3D preview will appear here after generating STL</p>
                  </div>
                  <!-- Screen reader accessible model summary (WCAG 2.2 non-visual content) -->
                  <div id="previewModelSummary" class="sr-only" aria-live="polite" aria-atomic="true">No model loaded. Upload an OpenSCAD file and generate an STL to see the 3D preview.</div>
                </div>
                
                <!-- Status bar overlay at bottom of preview -->
                <div class="preview-status-bar idle no-stats" id="previewStatusBar" role="status" aria-live="polite">
                  <span class="preview-status-text" id="previewStatusText">Ready</span>
                  <span class="preview-status-divider" aria-hidden="true"></span>
                  <span class="preview-status-stats" id="previewStatusStats"></span>
                  <!-- Alt adjust info (visible only in mono variant when alt view is enabled) -->
                  <span class="preview-status-alt-adjust" id="previewStatusAltAdjust"></span>
                </div>
              </div>
            </div>
            
            <!-- Actions bar with collapsible drawer and fixed primary action -->
            <div class="actions-bar" id="actionsBar" role="toolbar" aria-label="Model actions">
              <!-- Actions Drawer (collapsible, left side) -->
              <div class="actions-drawer collapsed" id="actionsDrawer" role="region" aria-label="Additional actions">
                <!-- Drawer header with toggle button and title -->
                <div class="actions-drawer-header" data-tutorial-target="actions-drawer-toggle">
                  <button 
                    id="actionsDrawerToggle" 
                    class="btn btn-sm btn-icon btn-collapse-panel actions-drawer-toggle-btn" 
                    aria-expanded="false" 
                    aria-controls="actionsDrawerBody"
                    aria-label="Expand actions menu"
                    title="More Actions"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="13 6 7 12 13 18"></polyline>
                      <line x1="17" y1="4" x2="17" y2="20" stroke-width="2"></line>
                    </svg>
                  </button>
                  <h2 class="actions-drawer-title">Actions</h2>
                </div>
                
                <!-- Drawer body (expandable content) -->
                <div class="actions-drawer-body" id="actionsDrawerBody">
                  <button id="addToComparisonBtn" class="btn btn-sm btn-secondary actions-drawer-btn" aria-label="Add current configuration to comparison">
                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="3" y="3" width="7" height="18" rx="1"></rect>
                      <rect x="14" y="3" width="7" height="18" rx="1"></rect>
                    </svg>
                    <span class="btn-text">Compare</span>
                  </button>
                  
                  <span class="actions-drawer-divider" aria-hidden="true"></span>
                  
                  <button id="addToQueueBtn" class="btn btn-sm btn-secondary actions-drawer-btn" aria-label="Add current configuration to render queue">
                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                      <path d="M12 8v8"></path>
                      <path d="M8 12h8"></path>
                    </svg>
                    <span class="btn-text">Add to Queue</span>
                  </button>
                  
                  <button id="viewQueueBtn" class="btn btn-sm btn-secondary actions-drawer-btn" aria-label="View and manage render queue">
                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M4 6h16"></path>
                      <path d="M4 12h16"></path>
                      <path d="M4 18h16"></path>
                    </svg>
                    <span class="btn-text">Queue</span>
                    <span class="queue-badge" id="queueBadge">0</span>
                  </button>
                  
                  <span class="actions-drawer-divider" aria-hidden="true"></span>
                  
                  <button id="shareBtn" class="btn btn-sm btn-secondary actions-drawer-btn" aria-label="Copy shareable link with current parameters">
                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    <span class="btn-text">Share Link</span>
                  </button>
                  
                  <button id="exportParamsBtn" class="btn btn-sm btn-secondary actions-drawer-btn" aria-label="Download parameters as JSON file">
                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <span class="btn-text">Export Params</span>
                  </button>
                </div>
              </div>
              
              <!-- Primary actions (always visible, right side) -->
              <div class="actions-primary">
                <button id="cancelRenderBtn" class="btn btn-outline hidden" aria-label="Cancel current render operation">
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                  </svg>
                  <span>Cancel</span>
                </button>
                <button id="primaryActionBtn" class="btn btn-primary btn-large" aria-label="Generate STL file from current parameters" data-action="generate" data-tutorial-target="primary-action">Generate STL</button>
                <a id="downloadFallbackLink" href="#" class="btn btn-sm btn-outline hidden" aria-label="Download previously generated file">
                  <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  <span>Download last file</span>
                </a>
              </div>
              
              <!-- Mobile Camera Controls Drawer (visible only on mobile) -->
              <div class="camera-drawer collapsed" id="cameraDrawer" role="region" aria-label="Camera controls">
                <!-- Drawer toggle button -->
                <button 
                  id="cameraDrawerToggle" 
                  class="btn btn-sm camera-drawer-toggle-btn" 
                  aria-expanded="false" 
                  aria-controls="cameraDrawerBody"
                  aria-label="Expand camera controls"
                  title="Camera Controls"
                  data-tutorial-target="mobile-camera-drawer-toggle"
                >
                  <svg class="camera-drawer-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <polyline class="drawer-chevron" points="6 9 12 15 18 9"></polyline>
                  </svg>
                  <span class="camera-drawer-label">Camera</span>
                </button>
                
                <!-- Drawer body (expandable content - game controller layout) -->
                <div class="camera-drawer-body" id="cameraDrawerBody">
                  <!-- Left: Rotate View D-pad with label in center -->
                  <div class="camera-drawer-section camera-drawer-rotate">
                    <div class="camera-drawer-dpad" role="group" aria-label="Rotation controls">
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-up" id="mobileCameraRotateUp" aria-label="Rotate view up" title="Rotate up">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <polyline points="18 15 12 9 6 15"></polyline>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-left" id="mobileCameraRotateLeft" aria-label="Rotate view left" title="Rotate left">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                      </button>
                      <span class="camera-drawer-dpad-label">Rotate</span>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-right" id="mobileCameraRotateRight" aria-label="Rotate view right" title="Rotate right">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-down" id="mobileCameraRotateDown" aria-label="Rotate view down" title="Rotate down">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Center: Zoom + Reset -->
                  <div class="camera-drawer-section camera-drawer-zoom">
                    <h3 class="camera-drawer-section-title">Zoom</h3>
                    <div class="camera-drawer-zoom-controls" role="group" aria-label="Zoom controls">
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn" id="mobileCameraZoomIn" aria-label="Zoom in" title="Zoom in">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <circle cx="11" cy="11" r="8"></circle>
                          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                          <line x1="11" y1="8" x2="11" y2="14"></line>
                          <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn" id="mobileCameraZoomOut" aria-label="Zoom out" title="Zoom out">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <circle cx="11" cy="11" r="8"></circle>
                          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                          <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm camera-drawer-btn camera-drawer-reset-btn" id="mobileCameraResetView" aria-label="Reset camera to default view" title="Reset view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                          <path d="M3 3v5h5"></path>
                        </svg>
                        <span>Reset</span>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Right: Pan View D-pad with label in center -->
                  <div class="camera-drawer-section camera-drawer-pan">
                    <div class="camera-drawer-dpad" role="group" aria-label="Pan controls">
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-up" id="mobileCameraPanUp" aria-label="Pan view up" title="Pan up">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <line x1="12" y1="19" x2="12" y2="5"></line>
                          <polyline points="5 12 12 5 19 12"></polyline>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-left" id="mobileCameraPanLeft" aria-label="Pan view left" title="Pan left">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <line x1="19" y1="12" x2="5" y2="12"></line>
                          <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                      </button>
                      <span class="camera-drawer-dpad-label">Pan</span>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-right" id="mobileCameraPanRight" aria-label="Pan view right" title="Pan right">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                          <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                      </button>
                      <button type="button" class="btn btn-sm btn-icon camera-drawer-btn dpad-down" id="mobileCameraPanDown" aria-label="Pan view down" title="Pan down">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <polyline points="19 12 12 19 5 12"></polyline>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Camera Controls Panel (Right Side Drawer) -->
          <div class="camera-panel collapsed" id="cameraPanel" role="region" aria-label="Camera controls">
            <div class="panel-header camera-panel-header">
              <button 
                id="cameraPanelToggle" 
                class="btn btn-sm btn-icon btn-collapse-panel" 
                aria-expanded="false" 
                aria-controls="cameraPanelBody" 
                aria-label="Expand camera controls panel"
                title="Camera Controls"
                data-tutorial-target="camera-panel-toggle"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <polyline points="13 6 7 12 13 18"></polyline>
                  <line x1="17" y1="4" x2="17" y2="20" stroke-width="2"></line>
                </svg>
              </button>
              <h2 id="camera-controls-heading">Camera</h2>
            </div>
            
            <div class="camera-panel-body" id="cameraPanelBody">
              <!-- Rotation Controls - D-pad layout -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Rotate View</h3>
                <div class="camera-control-dpad" role="group" aria-label="Rotation controls">
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-up" id="cameraRotateUp" aria-label="Rotate view up" title="Rotate up (Arrow Up)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-left" id="cameraRotateLeft" aria-label="Rotate view left" title="Rotate left (Arrow Left)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-right" id="cameraRotateRight" aria-label="Rotate view right" title="Rotate right (Arrow Right)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-down" id="cameraRotateDown" aria-label="Rotate view down" title="Rotate down (Arrow Down)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Pan Controls - D-pad layout -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Pan View</h3>
                <div class="camera-control-dpad" role="group" aria-label="Pan controls">
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-up" id="cameraPanUp" aria-label="Pan view up" title="Pan up (Shift + Arrow Up)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <line x1="12" y1="19" x2="12" y2="5"></line>
                      <polyline points="5 12 12 5 19 12"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-left" id="cameraPanLeft" aria-label="Pan view left" title="Pan left (Shift + Arrow Left)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <line x1="19" y1="12" x2="5" y2="12"></line>
                      <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-right" id="cameraPanRight" aria-label="Pan view right" title="Pan right (Shift + Arrow Right)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                      <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="btn btn-sm btn-icon camera-btn dpad-down" id="cameraPanDown" aria-label="Pan view down" title="Pan down (Shift + Arrow Down)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <polyline points="19 12 12 19 5 12"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Zoom Controls -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Zoom</h3>
                <div class="camera-control-row">
                  <button type="button" class="btn btn-sm camera-btn-wide" id="cameraZoomIn" aria-label="Zoom in" title="Zoom in (+)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <circle cx="11" cy="11" r="8"></circle>
                      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                      <line x1="11" y1="8" x2="11" y2="14"></line>
                      <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    <span>Zoom In</span>
                  </button>
                  <button type="button" class="btn btn-sm camera-btn-wide" id="cameraZoomOut" aria-label="Zoom out" title="Zoom out (-)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <circle cx="11" cy="11" r="8"></circle>
                      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                      <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    <span>Zoom Out</span>
                  </button>
                </div>
              </div>
              
              <!-- Reset View -->
              <div class="camera-control-section">
                <button type="button" class="btn btn-sm btn-outline camera-btn-full" id="cameraResetView" aria-label="Reset camera to default view" title="Reset view (Home)">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                  </svg>
                  <span>Reset View</span>
                </button>
              </div>
              
              <!-- Keyboard Shortcuts Help -->
              <div class="camera-shortcuts-help">
                <details class="camera-shortcuts-details">
                  <summary class="camera-shortcuts-summary" aria-label="Keyboard shortcuts">
                    <span class="camera-shortcuts-icon" aria-hidden="true">
                      <svg class="btn-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="miter">
                        <rect x="3" y="7" width="18" height="10" rx="0"></rect>
                        <line x1="6" y1="10" x2="8" y2="10"></line>
                        <line x1="9.5" y1="10" x2="11.5" y2="10"></line>
                        <line x1="13" y1="10" x2="15" y2="10"></line>
                        <line x1="16.5" y1="10" x2="18.5" y2="10"></line>
                        <line x1="6" y1="13.5" x2="10" y2="13.5"></line>
                        <line x1="11.5" y1="13.5" x2="18.5" y2="13.5"></line>
                      </svg>
                    </span>
                    <span class="camera-shortcuts-label">Keyboard Shortcuts</span>
                  </summary>
                  <dl class="camera-shortcuts-list">
                    <div class="camera-shortcut-item">
                      <dt>Arrow Keys</dt>
                      <dd>Rotate view</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Shift + Arrows</dt>
                      <dd>Pan view</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>+ / -</dt>
                      <dd>Zoom in/out</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Mouse Drag</dt>
                      <dd>Orbit camera</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Scroll Wheel</dt>
                      <dd>Zoom</dd>
                    </div>
                  </dl>
                </details>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Comparison View (hidden by default) -->
        <div class="comparison-view hidden" id="comparisonView" role="region" aria-label="Comparison view">
          <!-- Comparison UI will be dynamically generated here -->
        </div>
      </main>
      
      <div class="error-message hidden" id="errorMessage" role="alert" aria-live="assertive" aria-atomic="true"></div>
    </div>
    
    <!-- Render Queue Modal -->
    <div class="modal hidden" id="renderQueueModal" role="dialog" aria-labelledby="queueModalTitle" aria-modal="true">
      <div class="modal-overlay" id="queueModalOverlay"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 id="queueModalTitle">Render Queue</h2>
          <button class="modal-close" id="queueModalClose" aria-label="Close render queue">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body" id="queueModalBody">
          <!-- Queue controls -->
          <div class="queue-controls">
            <button id="processQueueBtn" class="btn btn-primary" aria-label="Process all queued jobs">
              ‚ñ∂Ô∏è Process Queue
            </button>
            <button id="stopQueueBtn" class="btn btn-outline hidden" aria-label="Stop processing queue">
              ‚è∏Ô∏è Stop
            </button>
            <button id="clearCompletedBtn" class="btn btn-outline" aria-label="Clear completed jobs">
              üóëÔ∏è Clear Completed
            </button>
            <button id="clearQueueBtn" class="btn btn-outline" aria-label="Clear all jobs">
              üóëÔ∏è Clear All
            </button>
            <button id="exportQueueBtn" class="btn btn-outline" aria-label="Export queue as JSON">
              üíæ Export Queue
            </button>
            <button id="importQueueBtn" class="btn btn-outline" aria-label="Import queue from JSON">
              üìÇ Import Queue
            </button>
          </div>
          
          <!-- Queue statistics -->
          <div class="queue-stats" id="queueStats" aria-live="polite">
            <span class="queue-stat">Total: <strong id="queueStatsTotal">0</strong></span>
            <span class="queue-stat">Queued: <strong id="queueStatsQueued">0</strong></span>
            <span class="queue-stat">Rendering: <strong id="queueStatsRendering">0</strong></span>
            <span class="queue-stat">Complete: <strong id="queueStatsComplete">0</strong></span>
            <span class="queue-stat">Error: <strong id="queueStatsError">0</strong></span>
          </div>
          
          <!-- Queue list -->
          <div class="queue-list" id="queueList" role="list">
            <!-- Queue items will be dynamically generated here -->
            <div class="queue-empty" id="queueEmpty" role="listitem">
              <p>No jobs in queue</p>
              <p class="queue-empty-hint">Click "Add to Queue" to add jobs</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Hidden file input for queue import -->
    <input type="file" id="queueImportInput" accept=".json" style="display: none;" aria-hidden="true" />
    
    <!-- Source Code Viewer Modal -->
    <div class="modal hidden" id="sourceViewerModal" role="dialog" aria-labelledby="sourceViewerTitle" aria-modal="true">
      <div class="modal-overlay" id="sourceViewerOverlay"></div>
      <div class="modal-content modal-large modal-source">
        <div class="modal-header">
          <h2 id="sourceViewerTitle">OpenSCAD Source</h2>
          <div class="source-viewer-actions">
            <button class="btn btn-sm btn-outline" id="sourceViewerCopy" aria-label="Copy source code">
              üìã Copy
            </button>
            <button class="modal-close" id="sourceViewerClose" aria-label="Close source viewer">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="modal-body source-viewer-body">
          <textarea id="sourceViewerContent" class="source-viewer-textarea" readonly aria-label="OpenSCAD source code" spellcheck="false"></textarea>
          <div class="source-viewer-info" id="sourceViewerInfo">
            <!-- File info will be displayed here -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- Parameters JSON Viewer Modal -->
    <div class="modal hidden" id="paramsJsonModal" role="dialog" aria-labelledby="paramsJsonTitle" aria-modal="true">
      <div class="modal-overlay" id="paramsJsonOverlay"></div>
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h2 id="paramsJsonTitle">Current Parameters (JSON)</h2>
          <div class="params-json-actions">
            <button class="btn btn-sm btn-outline" id="paramsJsonCopy" aria-label="Copy parameters JSON">
              üìã Copy
            </button>
            <button class="modal-close" id="paramsJsonClose" aria-label="Close parameters viewer">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="modal-body">
          <textarea id="paramsJsonContent" class="params-json-textarea" readonly aria-label="Parameters JSON" spellcheck="false"></textarea>
        </div>
      </div>
    </div>
    
    <!-- Features Guide Modal -->
    <div class="modal hidden" id="featuresGuideModal" role="dialog" aria-labelledby="featuresGuideTitle" aria-modal="true">
      <div class="modal-overlay" id="featuresGuideOverlay"></div>
      <div class="modal-content modal-large" data-tutorial-target="features-guide-modal">
        <div class="modal-header">
          <h2 id="featuresGuideTitle">Features Guide</h2>
          <button class="modal-close" id="featuresGuideClose" aria-label="Close features guide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body features-guide-body">
          <!-- Tab navigation for feature sections -->
          <div class="features-tabs" role="tablist" aria-label="Feature sections">
            <button class="features-tab" role="tab" aria-selected="true" aria-controls="featuresPanelLibraries" id="tab-libraries" tabindex="0">Libraries</button>
            <button class="features-tab" role="tab" aria-selected="false" aria-controls="featuresPanelColors" id="tab-colors" tabindex="-1">Color Parameters</button>
            <button class="features-tab" role="tab" aria-selected="false" aria-controls="featuresPanelPresets" id="tab-presets" tabindex="-1">Presets</button>
            <button class="features-tab" role="tab" aria-selected="false" aria-controls="featuresPanelAdvanced" id="tab-advanced" tabindex="-1">Advanced</button>
            <button class="features-tab" role="tab" aria-selected="false" aria-controls="featuresPanelWorkflow" id="tab-workflow" tabindex="-1">Workflow</button>
            <button class="features-tab" role="tab" aria-selected="false" aria-controls="featuresPanelAccessibility" id="tab-accessibility" tabindex="-1">Accessibility</button>
          </div>
          
          <!-- Libraries Panel -->
          <div class="features-panel" id="featuresPanelLibraries" role="tabpanel" tabindex="0" aria-labelledby="tab-libraries">
            <h3>OpenSCAD Library Bundles</h3>
            <p>This customizer includes popular OpenSCAD library bundles that provide reusable components and advanced functions for your models.</p>
            
            <h4>Available Libraries</h4>
            <ul class="features-list">
              <li><strong>MCAD</strong> ‚Äì Mechanical components like gears, screws, bearings, and fasteners</li>
              <li><strong>BOSL2</strong> ‚Äì Advanced geometry primitives, attachable parts, and complex shapes</li>
              <li><strong>NopSCADlib</strong> ‚Äì Parts library for 3D printers and electronics projects</li>
              <li><strong>dotSCAD</strong> ‚Äì Artistic patterns, designs, and creative geometry</li>
            </ul>
            
            <h4>How to Use Libraries</h4>
            <p>Include library modules in your OpenSCAD code:</p>
            <pre><code>use &lt;MCAD/boxes.scad&gt;;
use &lt;BOSL2/std.scad&gt;;</code></pre>
            
            <p>The customizer automatically detects which libraries your model uses and marks them as "required". You can also manually enable any library from the üìö Libraries panel.</p>
            
            <div class="features-action">
              <button class="btn btn-primary" data-example="library-test" data-feature-example="true">
                üìö Load Library Test Example
              </button>
              <p class="features-note">This example demonstrates MCAD library usage with mechanical components.</p>
            </div>

            <h4>Related Features</h4>
            <ul class="features-list">
              <li><strong>ZIP projects</strong> ‚Äì Upload a <code>.zip</code> containing multiple <code>.scad</code> files and dependencies</li>
              <li><strong>File tree</strong> ‚Äì View included files to confirm everything loaded correctly</li>
              <li><strong>Source viewer</strong> ‚Äì Inspect the fully assembled source (Advanced tab)</li>
            </ul>
          </div>
          
          <!-- Colors Panel -->
          <div class="features-panel" id="featuresPanelColors" role="tabpanel" tabindex="0" aria-labelledby="tab-colors" hidden>
            <h3>Color Parameters</h3>
            <p>Add interactive color pickers to your models by using the <code>[color]</code> annotation in your OpenSCAD parameters.</p>
            
            <h4>Syntax</h4>
            <pre><code>// Hex color with annotation
box_color = "FF6B35"; // [color]

// RGB hex format (with or without #)
primary_color = "#3498DB"; // [color]
secondary_color = "E74C3C"; // [color]</code></pre>
            
            <h4>How It Works</h4>
            <p>When you add the <code>// [color]</code> annotation to a string parameter, the customizer:</p>
            <ul class="features-list">
              <li>Displays a visual color picker instead of a text input</li>
              <li>Shows a color preview swatch next to the parameter</li>
              <li>Validates hex color values automatically</li>
              <li>Updates the preview in real-time as you change colors</li>
            </ul>
            
            <h4>Using Colors in Your Model</h4>
            <p>Use your color parameter in OpenSCAD however you prefer (RGB arrays, named colors, or helper functions). The example below includes a working conversion helper.</p>
            
            <div class="features-action">
              <button class="btn btn-primary" data-example="colored-box" data-feature-example="true">
                üé® Load Colored Box Example
              </button>
              <p class="features-note">This example shows how to use color parameters with a complete hex2rgb implementation.</p>
            </div>

            <h4>Preview-Only Model Color</h4>
            <p>You can also change the model‚Äôs display color without changing your OpenSCAD file:</p>
            <ul class="features-list">
              <li><strong>Preview Settings &amp; Info ‚Üí Model Color</strong> ‚Äì affects the preview only</li>
              <li><strong>Reset</strong> ‚Äì returns to the theme default display color</li>
            </ul>
          </div>
          
          <!-- Presets Panel -->
          <div class="features-panel" id="featuresPanelPresets" role="tabpanel" tabindex="0" aria-labelledby="tab-presets" hidden>
            <h3>Parameter Presets</h3>
            <p>Save and load your favorite parameter configurations to quickly switch between different variations of your model.</p>
            
            <h4>Saving Presets</h4>
            <ol class="features-list">
              <li>Adjust your parameters to the desired values</li>
              <li>Click the <strong>üíæ Save Preset</strong> button above the parameters</li>
              <li>Enter a descriptive name for your preset</li>
              <li>Your preset is saved locally in your browser</li>
            </ol>
            
            <h4>Loading Presets</h4>
            <p>Use the preset dropdown menu to quickly switch between saved configurations. The parameters will update automatically.</p>
            
            <h4>Managing Presets</h4>
            <ul class="features-list">
              <li><strong>Rename</strong> ‚Äì Update preset names for clarity</li>
              <li><strong>Delete</strong> ‚Äì Remove presets you no longer need</li>
              <li><strong>Export/Import</strong> ‚Äì Share presets with others or back them up</li>
            </ul>
            
            <p>Presets are stored per-file, so each model has its own set of saved configurations.</p>

            <h4>Sharing Your Configuration</h4>
            <ul class="features-list">
              <li><strong>Share Link</strong> (Actions menu) ‚Äì Copy a URL that includes your current parameters</li>
              <li><strong>Export Params</strong> (Actions menu) ‚Äì Download your current settings as a JSON file</li>
            </ul>
          </div>
          
          <!-- Advanced Panel -->
          <div class="features-panel" id="featuresPanelAdvanced" role="tabpanel" tabindex="0" aria-labelledby="tab-advanced" hidden>
            <h3>Advanced Features</h3>
            
            <h4>Parameter Search &amp; Jump</h4>
            <ul class="features-list">
              <li><strong>Search parameters</strong> ‚Äì Filter by name/description</li>
              <li><strong>Jump to group</strong> ‚Äì Quickly navigate long parameter lists</li>
              <li><strong>Show all</strong> ‚Äì Restore all parameters after a search</li>
            </ul>
            
            <h4>Output Formats</h4>
            <p>Export your customized models in multiple formats:</p>
            <ul class="features-list">
              <li><strong>STL</strong> ‚Äì Standard format for 3D printing (binary or ASCII)</li>
              <li><strong>OBJ</strong> ‚Äì Common 3D model format with material support</li>
              <li><strong>OFF</strong> ‚Äì Object File Format for geometry</li>
              <li><strong>AMF</strong> ‚Äì Additive Manufacturing File Format</li>
              <li><strong>3MF</strong> ‚Äì Modern 3D printing format with color support</li>
            </ul>
            
            <h4>Multi-File Projects</h4>
            <p>Upload ZIP files containing multiple OpenSCAD files. The customizer will:</p>
            <ul class="features-list">
              <li>Automatically detect the main file</li>
              <li>Extract and mount all included files</li>
              <li>Display a file tree showing the project structure</li>
              <li>Support relative paths in <code>include</code> and <code>use</code> statements</li>
            </ul>

            <div class="features-action">
              <button class="btn btn-primary" data-example="multi-file-box" data-feature-example="true">
                üß© Load Multi-file ZIP Example
              </button>
              <p class="features-note">A small ZIP project that demonstrates includes, modules, and the file tree.</p>
            </div>
            
            <h4>Parameter Limits Override</h4>
            <p>By default, sliders and number inputs respect the limits defined in your OpenSCAD file. You can unlock parameter limits from the Advanced menu to enter custom values.</p>
            
            <h4>Source Code Viewer</h4>
            <p>View the complete OpenSCAD source code, including all included files, from the Advanced menu. This helps verify that multi-file projects are loaded correctly.</p>

            <h4>Current Parameters as JSON</h4>
            <p>Use <strong>Advanced ‚Üí View Params JSON</strong> to copy or archive your current configuration (useful for clinics, classrooms, or troubleshooting).</p>
            
            <h4>Render Quality</h4>
            <p>Choose different quality levels for preview and exports:</p>
            <ul class="features-list">
              <li><strong>Preview quality</strong> ‚Äì Auto, Fidelity, Balanced, Fast</li>
              <li><strong>Export quality</strong> ‚Äì Model default, Low, Medium, High</li>
              <li><strong>Complexity indicator</strong> ‚Äì Shows a suggested quality tier based on your model</li>
            </ul>
          </div>

          <!-- Workflow Panel -->
          <div class="features-panel" id="featuresPanelWorkflow" role="tabpanel" tabindex="0" aria-labelledby="tab-workflow" hidden>
            <h3>Workflow &amp; Actions</h3>
            <p>The app is designed around a simple, repeatable workflow. A progress indicator at the top shows where you are.</p>

            <h4>The 4-Step Flow</h4>
            <ol class="features-list">
              <li><strong>Upload</strong> ‚Äì Load a <code>.scad</code> or <code>.zip</code> project</li>
              <li><strong>Customize</strong> ‚Äì Adjust parameters, use presets, search/jump for large models</li>
              <li><strong>Generate</strong> ‚Äì Create your output file (STL/OBJ/OFF/AMF/3MF)</li>
              <li><strong>Download</strong> ‚Äì Download the generated file (or download the last file again)</li>
            </ol>

            <h4>Actions Menu</h4>
            <p>Open the <strong>Actions</strong> drawer to find power features:</p>
            <ul class="features-list">
              <li><strong>Share Link</strong> ‚Äì Copy a URL with your current parameters</li>
              <li><strong>Export Params</strong> ‚Äì Download your configuration as JSON</li>
              <li><strong>Compare</strong> ‚Äì Track and compare parameter changes</li>
              <li><strong>Queue</strong> ‚Äì Batch multiple renders and process them later</li>
            </ul>

            <h4>Focus Mode</h4>
            <p>Use <strong>Full Screen</strong> (Focus Mode) to maximize the preview area when presenting or when working on smaller screens.</p>
          </div>

          <!-- Accessibility Panel -->
          <div class="features-panel" id="featuresPanelAccessibility" role="tabpanel" tabindex="0" aria-labelledby="tab-accessibility" hidden>
            <h3>Accessibility Features</h3>
            <p>The UI is built to support keyboard-only use, screen readers, voice control, and low-vision needs.</p>

            <h4>Keyboard &amp; Focus</h4>
            <ul class="features-list">
              <li><strong>Skip link</strong> ‚Äì Press <kbd>Tab</kbd> at the top to jump to main content</li>
              <li><strong>Undo / Redo</strong> ‚Äì <kbd>Ctrl</kbd>+<kbd>Z</kbd> / <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd></li>
              <li><strong>Focus indicators</strong> ‚Äì 3px visible outlines (4px in High Contrast mode)</li>
              <li><strong>Touch targets</strong> ‚Äì Buttons meet a 44√ó44px minimum size</li>
            </ul>

            <h4>Screen Readers</h4>
            <ul class="features-list">
              <li><strong>Status announcements</strong> ‚Äì Key operations are announced via live regions</li>
              <li><strong>Landmarks</strong> ‚Äì Major sections are labeled as regions for quick navigation</li>
              <li><strong>Plain-language errors</strong> ‚Äì Errors include clear titles and suggested fixes</li>
            </ul>

            <h4>Theme &amp; Contrast</h4>
            <ul class="features-list">
              <li><strong>Theme toggle</strong> ‚Äì Light / Dark</li>
              <li><strong>High Contrast (HC)</strong> ‚Äì AAA-oriented contrast and thicker focus/borders</li>
              <li><strong>Forced colors</strong> ‚Äì Works with Windows High Contrast / forced-colors mode</li>
              <li><strong>Reduced motion</strong> ‚Äì Respects <code>prefers-reduced-motion</code></li>
            </ul>

            <div class="features-action">
              <a class="btn btn-outline" href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/docs/guides/ACCESSIBILITY_GUIDE.md" target="_blank" rel="noopener noreferrer">
                üìò Full Accessibility Guide (opens in new tab)
              </a>
              <p class="features-note">Full details, including tested screen reader/browser combinations.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Reset All Confirmation Modal (COGA: Undo confirmation) -->
    <div class="modal hidden" id="resetConfirmModal" role="dialog" aria-labelledby="resetConfirmTitle" aria-modal="true">
      <div class="modal-overlay" id="resetConfirmOverlay"></div>
      <div class="modal-content modal-small confirm-modal-content">
        <div class="modal-header">
          <h2 id="resetConfirmTitle">Reset All Parameters?</h2>
          <button class="modal-close" id="resetConfirmClose" aria-label="Cancel reset">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body confirm-modal-body">
          <p>This will reset <strong id="resetParamCount">all</strong> parameters to their original default values.</p>
          <p class="confirm-warning">Any customizations you've made will be lost.</p>
        </div>
        <div class="modal-footer confirm-modal-footer">
          <button id="resetConfirmCancel" class="btn btn-secondary">Cancel</button>
          <button id="resetConfirmOk" class="btn btn-primary">Reset All</button>
        </div>
      </div>
    </div>
    
    <!-- First-Visit Disclosure Modal -->
    <div class="modal hidden" id="first-visit-modal" role="dialog" aria-labelledby="first-visit-title" aria-describedby="first-visit-description" aria-modal="true">
      <div class="modal-overlay" id="firstVisitOverlay"></div>
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h2 id="first-visit-title">Welcome to OpenSCAD Assistive Forge</h2>
        </div>
        <div class="modal-body" id="first-visit-description">
          <p><strong>This runs locally in your browser.</strong> Your model is processed on this device and is not uploaded to a server.</p>

          <h3>Before you start</h3>
          <ul class="features-list">
            <li><strong>One-time download:</strong> Your first render downloads the OpenSCAD engine (~15‚Äì30MB) and caches it for next time.</li>
            <li><strong>Saved here:</strong> Your designs and settings are stored in this browser (storage limits vary by device/browser).</li>
            <li><strong>Clearing site data removes saves:</strong> If you clear your browser storage/site data, saved work may be removed.</li>
          </ul>

          <p class="features-note"><strong>Continue</strong> to download and run the OpenSCAD engine locally.</p>

          <details class="file-info-details first-visit-details">
            <summary>Technical details</summary>
            <ul class="features-list">
              <li><strong>Local processing:</strong> Rendering happens on your device.</li>
              <li><strong>No server:</strong> Nothing is sent to external servers.</li>
              <li><strong>Privacy:</strong> Your data stays on your device.</li>
            </ul>
            <p class="features-note">
              Learn more:
              <a href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/README.md#how-it-works" target="_blank" rel="noopener noreferrer">How it works (opens in new tab)</a>
              ¬∑
              <a href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/docs/TROUBLESHOOTING.md#wasm-loading-issues" target="_blank" rel="noopener noreferrer">WASM download help (opens in new tab)</a>
            </p>
          </details>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="first-visit-continue">
            Download &amp; Continue
          </button>
        </div>
      </div>
    </div>
    
    <!-- Drawer backdrop (for mobile off-canvas) -->
    <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>
    
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
