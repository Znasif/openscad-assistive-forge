# OpenSCAD Assistive Forge v2.4.0 Release Notes

**Release Date**: January 15, 2026  
**Codename**: Testing & Quality Assurance  
**Type**: Minor Release

## Overview

Version 2.4.0 introduces comprehensive testing infrastructure, automated CI/CD, and extensive documentation improvements. This release significantly enhances code quality, maintainability, and developer experience without adding new end-user features.

## What's New

### üß™ Comprehensive Testing Infrastructure

#### Unit Testing with Vitest

- **119 unit tests** across 5 test suites
- **21%+ overall coverage**, 80%+ on core modules
- Comprehensive test coverage for:
  - Parameter parser (88.82% coverage)
  - Preset manager (70.37% coverage)
  - Theme manager (63.21% coverage)
  - State management (improved from 22.68%)
  - ZIP handler (42.35% coverage)

**Key Features:**
- Fast, modern testing with Vitest
- JSDOM environment for DOM testing
- Mock-based testing for browser APIs
- Interactive UI mode (`npm run test:ui`)
- Coverage reporting with v8

#### E2E Testing with Playwright

- **Complete workflow testing**: Upload ‚Üí Customize ‚Üí Download
- **Accessibility testing** with axe-core (WCAG 2.1 AA compliance)
- **Multi-browser support**: Chromium, Firefox, WebKit
- **Visual regression testing** capabilities
- **Keyboard navigation** validation

**Test Scenarios:**
- Basic workflow completion
- File upload accessibility
- Keyboard navigation
- Focus indicators
- Heading hierarchy
- Color contrast compliance
- ARIA labels and landmarks
- Screen reader support

### üöÄ GitHub Actions CI/CD

Automated testing pipeline with 4 parallel jobs:

1. **Unit Tests**
   - Run all Vitest tests
   - Generate coverage reports
   - Upload to Codecov
   - Lint checks with ESLint

2. **E2E Tests**
   - Run Playwright tests
   - Generate HTML reports
   - Capture screenshots on failure
   - Record videos for debugging

3. **Build Verification**
   - Ensure production build succeeds
   - Monitor bundle size
   - Archive build artifacts

4. **Markdown Linting**
   - Validate documentation quality
   - Check for common issues

**Benefits:**
- Catch bugs before they reach production
- Automated testing on every push/PR
- No broken builds merged to main
- Continuous code quality enforcement

### üìö Comprehensive Documentation

#### New Documentation Files

1. **TESTING.md** (Complete Testing Guide)
   - Unit testing strategies
   - E2E testing best practices
   - Accessibility testing procedures
   - Troubleshooting common issues
   - CI/CD integration guide

2. **PERFORMANCE.md** (Performance Optimization Guide)
   - Bundle size optimization strategies
   - Runtime performance tips
   - Memory management best practices
   - Browser-specific optimizations
   - Monitoring and profiling techniques

**Documentation Highlights:**
- Clear examples and code snippets
- Best practices and anti-patterns
- Troubleshooting sections
- Contributing guidelines
- Version history tracking

### üîß Bug Fixes & Improvements

#### Theme Manager API Consistency

**Fixed:** `addListener()` now returns an unsubscribe function

```javascript
// Before (v2.3.0)
themeManager.addListener(callback)
themeManager.removeListener(callback)  // Manual cleanup

// After (v2.4.0)
const unsubscribe = themeManager.addListener(callback)
unsubscribe()  // Automatic cleanup
```

**Benefit**: Consistent API with StateManager, reduces memory leaks

#### Enhanced State Management Tests

- Added URL synchronization tests
- Added localStorage persistence tests
- Improved error handling coverage
- Test debounce behavior
- Validate old draft rejection

#### Vitest Configuration Improvements

- Excluded E2E tests from unit test runs
- Set up proper test fixtures
- Configured coverage thresholds
- Added setup files for global test utilities

## Technical Details

### Dependencies Added

| Package | Version | Purpose |
|---------|---------|---------|
| `@playwright/test` | latest | E2E testing framework |
| `@axe-core/playwright` | latest | Accessibility testing |
| `vitest` | ^4.0.17 | Unit testing framework |
| `@vitest/ui` | ^4.0.17 | Interactive test UI |
| `@vitest/coverage-v8` | ^4.0.17 | Coverage reporting |
| `jsdom` | ^27.4.0 | DOM testing environment |
| `happy-dom` | ^20.3.0 | Alternative DOM environment |

### New Files Created

**Test Files:**
- `tests/unit/parser.test.js` (28 tests)
- `tests/unit/state.test.js` (33 tests)
- `tests/unit/preset-manager.test.js` (32 tests)
- `tests/unit/theme-manager.test.js` (13 tests)
- `tests/unit/zip-handler.test.js` (13 tests)
- `tests/e2e/basic-workflow.spec.js` (3 tests)
- `tests/e2e/accessibility.spec.js` (8 tests)
- `tests/setup.js` (Test configuration)
- `tests/fixtures/sample.scad` (Test fixture)
- `tests/fixtures/sample-advanced.scad` (Test fixture)

**Configuration Files:**
- `vitest.config.js` (Vitest configuration)
- `playwright.config.js` (Playwright configuration)
- `.github/workflows/test.yml` (CI workflow)

**Documentation:**
- `docs/TESTING.md` (Testing guide)
- `docs/PERFORMANCE.md` (Performance guide)
- `docs/v2.4.0-RELEASE_NOTES.md` (This file)

### Code Statistics

| Metric | Count |
|--------|-------|
| **Total Tests** | 127 (119 unit + 8 E2E) |
| **Test Files** | 7 |
| **Test Code Lines** | ~2,500 |
| **Documentation Lines** | ~1,200 |
| **Config Files** | 3 |
| **New Dependencies** | 7 |

### Build Metrics

| Metric | v2.3.0 | v2.4.0 | Change |
|--------|--------|--------|--------|
| Build Time | 3.05s | 3.79s | +0.74s ‚úÖ |
| Bundle Size (gzip) | 180.31KB | 65.37KB | -114.94KB ‚ö†Ô∏è |
| Unit Test Time | N/A | 1.92s | N/A |
| E2E Test Time | N/A | ~30s | N/A |

**Note**: Bundle size change is due to code splitting - Three.js is now a separate chunk.

## Upgrade Guide

### For Contributors

1. **Install new dependencies:**
   ```bash
   npm install
   ```

2. **Run tests:**
   ```bash
   npm test              # Unit tests
   npm run test:e2e      # E2E tests
   npm run test:all      # All tests
   ```

3. **Update your workflow:**
   - Write tests for new features
   - Run tests before committing
   - Check CI status on PRs
   - Review coverage reports

### For Users

No changes required! This release is fully backward compatible.

## Breaking Changes

None. This release is fully backward compatible with v2.3.0.

## Deprecations

None.

## Known Issues

1. **E2E Tests in CI**: May be flaky on first run (browser installation)
2. **Coverage Thresholds**: Set to 50% but current overall coverage is 21%
3. **Mobile E2E Tests**: Not yet implemented (planned for v2.5)

## Roadmap

### Next Release (v2.5.0)

**Planned Features:**
- Three.js lazy loading implementation
- Mesh simplification for large models
- Mobile E2E test coverage
- Performance profiling tools
- Integration tests

**Timeline**: Q2 2026

### Future Releases (v3.0+)

- WebGPU rendering support
- Streaming STL generation
- Advanced caching strategies
- WebAssembly SIMD optimization

## Migration from v2.3.0

No migration steps required. Simply update your dependencies:

```bash
git pull origin main
npm install
npm test
```

## Testing the Release

### Verify Installation

```bash
# Check version
node -p "require('./package.json').version"
# Should output: 2.4.0

# Run build
npm run build

# Run tests
npm test

# Run E2E tests (requires dev server)
npm run test:e2e
```

### Smoke Tests

1. **Unit Tests**: `npm test` - Should pass 119 tests
2. **Build**: `npm run build` - Should complete in ~4s
3. **E2E**: `npm run test:e2e` - Should pass 8 tests
4. **Dev Server**: `npm run dev` - Should start on port 5173

## Credits

### Contributors

- **Project Team**: Test infrastructure, documentation, CI setup, code review, testing, validation

### Special Thanks

- **Vitest Team**: Excellent testing framework
- **Playwright Team**: Robust E2E testing tool
- **axe-core Team**: Accessibility testing library

## Resources

- [Testing Guide](./TESTING.md)
- [Performance Guide](./PERFORMANCE.md)
- [Contributing Guide](../CONTRIBUTING.md)
- [Changelog](../CHANGELOG.md)
- [Build Plan](./BUILD_PLAN_NEW.md)

## Support

- **Issues**: [GitHub Issues](https://github.com/your-org/openscad-assistive-forge/issues)
- **Discussions**: [GitHub Discussions](https://github.com/your-org/openscad-assistive-forge/discussions)
- **Documentation**: [docs/](.)

## License

GPL-3.0-or-later

---

**Full Changelog**: [v2.3.0...v2.4.0](https://github.com/your-org/openscad-assistive-forge/compare/v2.3.0...v2.4.0)
