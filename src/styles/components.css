/* Component Styles */

/* Skip Link (Accessibility) */
/* Uses high-contrast blue instead of accent yellow for WCAG AAA compliance */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: #0047b3; /* Brand-neutral blue with 7:1 on white */
  color: #ffffff;
  padding: var(--space-sm) var(--space-md);
  text-decoration: none;
  font-weight: 600;
  z-index: 9999;
  border-radius: 0 0 var(--border-radius-sm) 0;
}

.skip-link:focus {
  top: 0;
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* Dark mode skip link */
:root[data-theme='dark'] .skip-link {
  background: #66b3ff; /* Light blue for dark mode - 4.5:1 on dark bg */
  color: #000000;
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .skip-link {
    background: #66b3ff; /* Light blue for dark mode - 4.5:1 on dark bg */
    color: #000000;
  }
}

/* Global focus ring for interactive elements that are not `.btn` */
a:focus,
button:focus,
summary:focus,
[role='button']:focus,
[tabindex]:focus,
a:focus-visible,
button:focus-visible,
summary:focus-visible,
[role='button']:focus-visible,
[tabindex]:focus-visible {
  outline: 3px solid var(--color-focus) !important;
  outline-offset: 2px !important;
}

/* Buttons */
.btn {
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  font-weight: 500;
  transition:
    background-color 0.2s,
    transform 0.1s;
  min-height: var(--size-touch-target);
  min-width: var(--size-touch-target);
  /* Default button styling - secondary-like appearance for buttons without color variant */
  background-color: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn:hover:not(:disabled) {
  background-color: var(--color-hover-bg);
  border-color: var(--color-text-secondary);
}

/* WCAG 2.2 SC 2.4.13 Focus Appearance: minimum 2px thickness, 3:1 contrast */
.btn:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.btn:focus:not(:focus-visible) {
  outline: none;
}

.btn:focus-visible {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  /* Additional border for increased perimeter size */
  box-shadow:
    0 0 0 1px var(--color-bg-primary),
    0 0 0 4px var(--color-focus);
}

.btn:active {
  transform: translateY(1px);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background-color: var(--color-accent);
  color: var(--color-on-accent);
}

.btn-primary:hover:not(:disabled) {
  background-color: var(--color-accent-hover);
}

.btn-success {
  background-color: var(--color-success);
  color: var(--color-on-success);
}

.btn-success:hover:not(:disabled) {
  background-color: var(--color-success-hover);
}

.btn-secondary {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover:not(:disabled) {
  background-color: var(--color-border);
}

.btn-sm {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  min-height: var(--size-touch-target-sm);
}

.btn-with-icon {
  gap: var(--space-xs);
}

.btn-outline {
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  color: var(--color-text-primary);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn-outline:hover:not(:disabled) {
  background-color: var(--color-hover-bg);
  border-color: var(--color-text-primary);
}

.btn-large {
  flex: 1;
  padding: var(--space-md) var(--space-lg);
  font-size: var(--font-size-lg);
}

.btn-icon {
  padding: var(--space-xs);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text-primary);
  min-width: var(--size-touch-target-sm);
  min-height: var(--size-touch-target-sm);
}

.btn-icon:hover:not(:disabled) {
  background-color: var(--color-bg-secondary);
  border-color: var(--color-accent);
}

/* ============================================================================
   Panel Collapse Button - Icon Rotation & States
   ============================================================================ */

#collapseParamPanelBtn svg {
  transition: transform 0.3s ease;
}

@media (prefers-reduced-motion: reduce) {
  #collapseParamPanelBtn svg {
    transition: none;
  }
}

/* Rotate icon 180° when collapsed to show "expand" direction */
.param-panel.collapsed #collapseParamPanelBtn svg {
  transform: rotate(180deg);
}

/* Desktop only - hide collapse button on mobile (drawer toggle is used instead) */
@media (max-width: 767px) {
  .panel-collapse-control {
    display: none;
  }
}

/* ============================================================================
   Mobile Drawer Toggle Button
   ============================================================================ */

.mobile-only {
  display: none;
}

@media (max-width: 767px) {
  .mobile-only {
    display: inline-flex;
  }
}

#mobileDrawerToggle {
  display: none;
  align-items: center;
  gap: var(--space-xs);
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
}

@media (max-width: 767px) {
  #mobileDrawerToggle {
    display: inline-flex;
  }
}

/* Hide label on very small screens for space efficiency */
@media (max-width: 360px) {
  #mobileDrawerToggle .btn-label {
    display: none;
  }
}

/* ============================================================================
   Preview Drawer Header
   ============================================================================
   Container for the preview settings drawer toggle and mobile params button.
   On mobile, both buttons appear side by side. On desktop, only the drawer
   toggle is visible since the params panel is always visible.
   ============================================================================ */

.preview-drawer-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  height: var(--drawer-header-height);
  min-height: var(--drawer-header-height);
  padding: 0 var(--space-sm);
  background-color: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  gap: var(--space-sm);
}

/* Header layout containers */
.preview-drawer-header-left {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  min-width: 0;
  flex: 1 1 auto;
}

.preview-drawer-header-right {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex: 0 0 auto;
}

.preview-drawer-title {
  margin: 0;
  font-size: var(--font-size-sm);
  font-weight: 600;
  line-height: 1.2;
  color: var(--color-text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Match Camera/Parameters collapse toggle button styling */
.preview-drawer-toggle-btn.btn-collapse-panel {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  border-right: 1px solid var(--color-border); /* override base .btn-collapse-panel */
  flex-shrink: 0;
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  padding: var(--space-xs);
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.preview-drawer-toggle-btn.btn-collapse-panel svg {
  transition: transform 0.2s ease;
  /* Base icon points left; rotate to point DOWN when collapsed (expand) */
  transform: rotate(90deg);
}

.preview-drawer-toggle-btn.btn-collapse-panel[aria-expanded='true'] svg {
  /* Rotate to point UP when expanded (collapse) */
  transform: rotate(-90deg);
}

@media (prefers-reduced-motion: reduce) {
  .preview-drawer-toggle-btn.btn-collapse-panel svg {
    transition: none;
  }
}

/* Preview drawer toggle now uses shared .btn-collapse-panel styling (see above). */

/* ============================================================================
   Actions Drawer Toggle Button (Mobile)
   ============================================================================
   Toggle button for expanding secondary actions in the actions bar.
   Arrow indicates expand (up) or collapse (down) state.
   ============================================================================ */

.actions-drawer-toggle {
  display: none;
}

@media (max-width: 767px) {
  .actions-drawer-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    width: 100%;
    min-height: 36px;
    padding: var(--space-xs) var(--space-md);
    background-color: var(--color-bg-tertiary);
    border: none;
    border-bottom: 1px solid var(--color-border);
    cursor: pointer;
    transition: background-color 0.2s ease;
    order: -2; /* Place at top of actions bar */
  }

  .actions-drawer-toggle:hover {
    background-color: var(--color-hover-bg);
  }

  .actions-drawer-toggle:focus-visible {
    outline: 3px solid var(--color-focus);
    outline-offset: -3px;
  }

  .actions-toggle-label {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  .actions-toggle-arrow {
    width: 18px;
    height: 18px;
    color: var(--color-accent);
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }

  /* Arrow flips when drawer content is visible */
  .actions-drawer-toggle[aria-expanded='true'] .actions-toggle-arrow {
    transform: rotate(180deg);
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .actions-toggle-arrow {
      transition: none;
    }
  }
}

/* Upload Zone */
.upload-zone {
  display: block;
  text-align: center;
  border: 2px dashed var(--color-border);
  border-radius: var(--border-radius-lg);
  padding: var(--space-xl);
  padding-left: max(var(--space-xl), env(safe-area-inset-left, 0px));
  padding-right: max(var(--space-xl), env(safe-area-inset-right, 0px));
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  outline: none;
}

.upload-zone:hover {
  border-color: var(--color-accent);
  background-color: var(--color-accent-subtle);
}

.upload-zone.drag-over {
  border-color: var(--color-accent);
  background-color: var(--color-hover-bg);
  transform: scale(1.02);
}

.upload-zone:focus,
.upload-zone:focus-within {
  border-color: var(--color-focus);
  box-shadow: var(--focus-ring);
}

.upload-icon {
  margin: 0 auto var(--space-md);
  color: var(--color-text-primary);
}

.upload-text {
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
}

.file-input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

.examples-section {
  margin-top: var(--space-xl);
  padding-top: var(--space-xl);
  padding-left: max(0px, env(safe-area-inset-left, 0px));
  padding-right: max(0px, env(safe-area-inset-right, 0px));
  border-top: 1px solid var(--color-border);
}

.examples-section p {
  margin-bottom: var(--space-md);
  color: var(--color-text-secondary);
}

.preview-settings-panel {
  margin: var(--space-sm) 0;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
}

.preview-settings-header {
  padding: var(--space-sm) var(--space-md);
  user-select: text;
  font-weight: 600;
  font-size: var(--font-size-sm);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  transition: background-color 0.2s ease;
}

.preview-settings-header:hover {
  background-color: var(--color-bg-primary);
}

.preview-settings-header:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.settings-icon {
  font-size: 1rem;
}

.preview-settings {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.preview-setting {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.preview-setting.cache-tools {
  flex-basis: 100%;
  justify-content: space-between;
}

.preview-setting.cache-tools .btn {
  margin-left: auto;
}

.preview-setting-label {
  margin-right: var(--space-xs);
}

.preview-settings select {
  min-height: 36px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  padding: 0 var(--space-sm);
}

.preview-settings input[type='checkbox'] {
  width: 18px;
  height: 18px;
}

.update-banner {
  position: sticky;
  top: 0;
  z-index: var(--z-index-sticky);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-sm) var(--space-md);
}

.update-banner.hidden {
  display: none;
}

.update-banner-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  flex-wrap: wrap;
}

.update-banner-text {
  color: var(--color-text-primary);
  font-weight: 600;
}

.update-banner-actions {
  display: inline-flex;
  align-items: center;
  gap: var(--space-sm);
}

/* Model Color Picker */
.model-color-setting {
  flex-basis: 100%;
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-xs);
}

.model-color-picker {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

.model-color-picker input[type='color'] {
  width: 44px;
  height: 32px;
  padding: var(--space-2xs);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  cursor: pointer;
  transition: border-color 0.2s;
}

.model-color-picker input[type='color']:hover {
  border-color: var(--color-accent);
}

.model-color-picker input[type='color']:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.model-color-picker .btn-icon {
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-secondary);
  font-size: var(--size-icon-sm);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.model-color-picker .btn-icon:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-accent);
  color: var(--color-text-primary);
}

.model-color-picker .btn-icon:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.example-buttons {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

@media (min-width: 768px) {
  .example-buttons {
    flex-direction: row;
    flex-wrap: wrap;
  }
}

/* Parameter Controls */
.param-group {
  margin-bottom: var(--space-lg);
}

.param-group summary {
  font-weight: 600;
  padding: var(--space-sm);
  cursor: pointer;
  user-select: none;
  list-style: none;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.param-group summary::-webkit-details-marker {
  display: none;
}

.param-group summary::before {
  content: '▶';
  display: inline-block;
  transition: transform 0.2s;
}

.param-group[open] summary::before {
  transform: rotate(90deg);
}

.param-group summary:focus-visible {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-control {
  margin-bottom: var(--space-md);
  padding: var(--space-sm);
  /* Smooth transitions for dependency visibility */
  transition:
    opacity 0.3s ease,
    max-height 0.3s ease,
    margin 0.3s ease,
    padding 0.3s ease;
  overflow: hidden;
}

/* Hidden state for dependent parameters */
.param-control[aria-hidden='true'] {
  opacity: 0;
  max-height: 0;
  margin: 0;
  padding: 0;
  pointer-events: none;
}

/* Reduced motion: instant show/hide */
@media (prefers-reduced-motion: reduce) {
  .param-control {
    transition: none;
  }
}

.param-description {
  display: block;
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin-top: var(--space-xs);
  font-style: italic;
}

.param-control label {
  display: block;
  font-weight: 500;
  margin-bottom: var(--space-xs);
  color: var(--color-text-primary);
}

/* Help Tooltip Styles */
.param-label-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.param-help-wrapper {
  position: relative;
  display: inline-block;
}

.param-help-button {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  font-size: var(--font-size-2xs);
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    background-color 0.2s,
    transform 0.1s;
  flex-shrink: 0;
}

.param-help-button:hover {
  background: var(--color-accent-hover);
  transform: scale(1.1);
}

.param-help-button:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-help-button:active {
  transform: scale(0.95);
}

.param-help-button[aria-expanded='true'] {
  background: var(--color-accent-hover);
}

.param-tooltip {
  position: absolute;
  top: calc(100% + var(--space-sm));
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-sm) var(--space-md);
  max-width: 280px;
  min-width: 200px;
  font-size: var(--font-size-sm);
  line-height: 1.4;
  color: var(--color-text-primary);
  box-shadow: var(--shadow-md);
  z-index: 1000;
  white-space: normal;
  word-wrap: break-word;
}

.param-tooltip::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-bottom-color: var(--color-border);
}

.param-tooltip::after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-bottom-color: var(--color-bg-secondary);
  margin-bottom: calc(var(--space-2xs) / 2);
}

/* High Contrast Mode Adjustments for Tooltips */
body.high-contrast .param-help-button {
  border: 2px solid currentColor;
}

body.high-contrast .param-tooltip {
  border-width: 2px;
}

/* Dark Mode Adjustments for Tooltips */
@media (prefers-color-scheme: dark) {
  .param-tooltip {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }
}

/* Mobile Adjustments for Tooltips */
@media (max-width: 768px) {
  .param-tooltip {
    position: fixed;
    left: 16px;
    right: 16px;
    top: auto;
    bottom: calc(env(safe-area-inset-bottom, 16px) + 16px);
    width: auto;
    max-width: none;
    transform: none;
    font-size: var(--font-size-base);
  }

  .param-tooltip::before,
  .param-tooltip::after {
    display: none;
  }
}

.param-unit {
  color: var(--color-text-secondary);
  font-weight: normal;
  font-size: var(--font-size-sm);
  margin-left: var(--space-xs);
}

/* Range Slider */
.slider-container {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}

.slider-container input[type='range'] {
  flex: 1;
  height: 6px;
  border-radius: var(--border-radius-xs);
  background: var(--color-bg-secondary);
  outline: none;
}

.slider-container input[type='range']:focus {
  box-shadow: var(--focus-ring);
}

.slider-container input[type='range']:focus:not(:focus-visible) {
  box-shadow: none;
}

.slider-container input[type='range']:focus-visible {
  box-shadow: var(--focus-ring);
}

.slider-value {
  min-width: 60px;
  text-align: right;
  font-weight: 600;
  color: var(--color-text-primary);
}

/* Number Input Container with Unit */
.number-input-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.number-input-container input[type='number'] {
  flex: 1;
}

/* Unit Label */
.unit-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
  min-width: 30px;
  text-align: left;
}

/* High contrast mode for unit labels */
body.high-contrast .unit-label {
  font-weight: 600;
  color: var(--color-text);
}

/* Number Input */
input[type='number'] {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
}

input[type='number']:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

input[type='number']:focus:not(:focus-visible) {
  box-shadow: none;
  border-color: var(--color-border);
}

input[type='number']:focus-visible {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

/* Select Dropdown */
select {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}

select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

select:focus:not(:focus-visible) {
  box-shadow: none;
  border-color: var(--color-border);
}

select:focus-visible {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

/* Toggle Switch */
.toggle-switch {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.toggle-switch input[type='checkbox'] {
  width: 48px;
  height: 28px;
  appearance: none;
  background-color: var(--color-border);
  border-radius: var(--border-radius-pill);
  position: relative;
  cursor: pointer;
  transition: background-color 0.2s;
}

.toggle-switch input[type='checkbox']:focus {
  box-shadow: var(--focus-ring);
}

.toggle-switch input[type='checkbox']:focus:not(:focus-visible) {
  box-shadow: none;
}

.toggle-switch input[type='checkbox']:focus-visible {
  box-shadow: var(--focus-ring);
}

.toggle-switch input[type='checkbox']::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: white;
  top: 2px;
  left: 2px;
  transition: transform 0.2s;
}

.toggle-switch input[type='checkbox']:checked {
  background-color: var(--color-success);
}

.toggle-switch input[type='checkbox']:checked::before {
  transform: translateX(20px);
}

.toggle-label {
  font-weight: normal;
  color: var(--color-text-secondary);
}

/* Progress Indicator */
.progress-bar {
  width: 100%;
  height: 4px;
  background-color: var(--color-bg-secondary);
  border-radius: var(--border-radius-xs);
  overflow: hidden;
  margin-top: var(--space-sm);
}

.progress-fill {
  height: 100%;
  background-color: var(--color-accent);
  transition: width 0.3s;
}

/* Loading Spinner */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid var(--color-bg-secondary);
  border-top-color: var(--color-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ========================================
   Auto-Preview Indicator Styles (v1.2)
   ======================================== */

/* Preview container wrapper */
.preview-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

/* Preview state indicator badge */
.preview-state-indicator {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  font-weight: 500;
  z-index: 10;
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  transition: all 0.3s ease;
}

/* State: Idle - no preview yet */
.preview-state-indicator.state-idle {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-secondary);
}

/* State: Current - preview matches parameters */
.preview-state-indicator.state-current {
  background-color: var(--color-success);
  color: var(--color-on-success);
}

/* State: Pending - parameter changed, render scheduled */
.preview-state-indicator.state-pending {
  background-color: var(--color-warning);
  color: var(--color-on-warning);
  animation: pulse-pending 1.5s ease-in-out infinite;
}

/* State: Rendering - preview render in progress */
.preview-state-indicator.state-rendering {
  background-color: var(--color-accent);
  color: var(--color-on-accent);
}

/* State: Stale - preview outdated */
.preview-state-indicator.state-stale {
  background-color: var(--color-warning-hover);
  color: var(--color-on-warning);
}

/* State: Error - render failed */
.preview-state-indicator.state-error {
  background-color: var(--color-error-bg);
  color: var(--color-text-primary);
  border: 1px solid var(--color-error);
}

/* Pulse animation for pending state */
@keyframes pulse-pending {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.02);
  }
}

/* Preview border states */
.preview-container {
  transition:
    border-color 0.3s ease,
    box-shadow 0.3s ease;
}

.preview-container.preview-pending {
  border: 2px solid var(--color-warning);
  box-shadow: 0 0 8px var(--color-warning);
}

.preview-container.preview-stale {
  border: 2px solid var(--color-warning);
  box-shadow: 0 0 8px var(--color-warning);
}

.preview-container.preview-rendering {
  border: 2px solid var(--color-accent);
  animation: border-pulse 1s ease-in-out infinite;
}

.preview-container.preview-current {
  border: 2px solid var(--color-success);
}

.preview-container.preview-error {
  border: 2px solid var(--color-error);
}

@keyframes border-pulse {
  0%,
  100% {
    box-shadow: var(--focus-ring);
  }
  50% {
    box-shadow: 0 0 0 4px var(--color-focus);
  }
}

/* Rendering overlay */
.preview-rendering-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 20;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.preview-rendering-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.preview-rendering-overlay .spinner-large {
  width: 48px;
  height: 48px;
  border-width: 4px;
}

.preview-rendering-overlay .rendering-text {
  margin-top: var(--space-md);
  color: white;
  font-size: var(--font-size-base);
  font-weight: 500;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

/* Auto-preview toggle in settings */
.auto-preview-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) 0;
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-md);
}

.auto-preview-toggle label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

/* Quality indicator */
.quality-indicator {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-left: var(--space-xs);
}

.quality-indicator.preview-quality {
  color: var(--color-warning);
}

.quality-indicator.full-quality {
  color: var(--color-success);
}

/* Stats with quality info */
.stats-quality {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
}

.stats-quality.preview {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

.stats-quality.full {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

/* Complexity tier indicator */
.complexity-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-sm);
  padding: var(--space-xs) 0;
}

.complexity-tier-label {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-weight: 500;
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.complexity-tier-label.tier-beginner {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

.complexity-tier-label.tier-standard {
  background-color: var(--color-info-bg);
  color: var(--color-info-text);
}

.complexity-tier-label.tier-complex {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

/* Dark theme overrides for complexity indicator - now handled by semantic tokens */
[data-theme='dark'] .complexity-tier-label.tier-beginner {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

[data-theme='dark'] .complexity-tier-label.tier-standard {
  background-color: var(--color-info-bg);
  color: var(--color-info-text);
}

[data-theme='dark'] .complexity-tier-label.tier-complex {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

/* Responsive adjustments */
@media (prefers-reduced-motion: reduce) {
  .preview-state-indicator.state-pending,
  .preview-container.preview-rendering {
    animation: none;
  }

  @keyframes pulse-pending {
    0%,
    100% {
      opacity: 1;
    }
  }

  @keyframes border-pulse {
    0%,
    100% {
      box-shadow: var(--focus-ring);
    }
  }
}

/* File Tree (ZIP Projects) */
.file-tree {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  max-height: 200px;
  overflow-y: auto;
  scrollbar-gutter: stable;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

.preset-modal-content::-webkit-scrollbar,
.file-tree::-webkit-scrollbar {
  width: 8px;
}

.preset-modal-content::-webkit-scrollbar-track,
.file-tree::-webkit-scrollbar-track {
  background: transparent;
}

.preset-modal-content::-webkit-scrollbar-thumb,
.file-tree::-webkit-scrollbar-thumb {
  background-color: var(--color-border);
  border-radius: var(--border-radius-sm);
  border: 2px solid transparent;
  background-clip: content-box;
}

.preset-modal-content::-webkit-scrollbar-thumb:hover,
.file-tree::-webkit-scrollbar-thumb:hover {
  background-color: var(--color-text-secondary);
}

/* Dark mode scrollbar contrast */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .preset-modal-content,
  :root:not([data-theme='light']) .file-tree {
    scrollbar-color: var(--color-border) transparent;
  }

  :root:not([data-theme='light'])
    .preset-modal-content::-webkit-scrollbar-thumb,
  :root:not([data-theme='light']) .file-tree::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  :root:not([data-theme='light'])
    .preset-modal-content::-webkit-scrollbar-thumb:hover,
  :root:not([data-theme='light']) .file-tree::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-text-secondary);
  }
}

:root[data-theme='dark'] .preset-modal-content,
:root[data-theme='dark'] .file-tree {
  scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
}

:root[data-theme='dark'] .preset-modal-content::-webkit-scrollbar-thumb,
:root[data-theme='dark'] .file-tree::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.35);
}

:root[data-theme='dark'] .preset-modal-content::-webkit-scrollbar-thumb:hover,
:root[data-theme='dark'] .file-tree::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}

.file-tree-header {
  font-weight: 600;
  margin-bottom: var(--space-xs);
  padding-bottom: var(--space-xs);
  border-bottom: 1px solid var(--color-border);
  font-family: var(--font-family-base);
}

.file-tree-item {
  padding: var(--space-2xs) 0;
  padding-left: var(--space-md);
  color: var(--color-text-secondary);
}

.file-tree-item.main {
  font-weight: 600;
  color: var(--color-text-primary);
}

.file-tree-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  margin-left: var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  font-size: var(--font-size-2xs);
  border-radius: var(--border-radius-xs);
  font-weight: 600;
  font-family: var(--font-family-base);
}

/* Format Selector */
.format-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
  flex-wrap: wrap;
}

.format-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  white-space: nowrap;
}

.format-select {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  min-width: 200px;
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.format-select:hover {
  border-color: var(--color-accent);
}

.format-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.format-info {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: italic;
  flex: 1;
  min-width: 200px;
}

/* High contrast mode adjustments for format selector */
:root[data-high-contrast='true'] .format-select {
  border-width: 2px;
}

@media (max-width: 768px) {
  .format-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .format-select,
  .format-info {
    width: 100%;
  }
}

/* Output Format Section (Left Panel) */
.output-format-section {
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
}

.output-format-label {
  display: block;
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-xs);
}

.output-format-select {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.output-format-select:hover {
  border-color: var(--color-accent);
}

.output-format-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.output-format-info {
  display: block;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-style: italic;
  margin-top: var(--space-xs);
}

/* High contrast mode adjustments for output format */
:root[data-high-contrast='true'] .output-format-select {
  border-width: 2px;
}

/* Preset Controls */
.preset-controls {
  padding: 0;
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
  border: 1px solid var(--color-border);
}

.preset-summary {
  padding: var(--space-sm) var(--space-md);
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  transition: background-color 0.2s ease;
}

.preset-summary:hover {
  background-color: var(--color-bg-primary);
}

.preset-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.preset-icon {
  font-size: 1rem;
}

.preset-content {
  padding: var(--space-md);
  padding-top: 0;
}

.preset-controls[open] .preset-summary {
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--space-sm);
}

.preset-actions {
  display: flex;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  flex-wrap: wrap;
}

.preset-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.preset-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  white-space: nowrap;
}

.preset-select {
  flex: 1;
  min-width: 200px;
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
  min-height: 36px;
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.preset-select:hover {
  border-color: var(--color-accent);
}

.preset-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.preset-select:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* High contrast mode adjustments for presets */
:root[data-high-contrast='true'] .preset-controls {
  border-width: 2px;
}

:root[data-high-contrast='true'] .preset-select {
  border-width: 2px;
}

/* Preset Management Modal */
.preset-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: var(--space-md);
  padding-top: calc(var(--space-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom, 0px));
  padding-left: calc(var(--space-md) + env(safe-area-inset-left, 0px));
  padding-right: calc(var(--space-md) + env(safe-area-inset-right, 0px));
}

.preset-modal-content {
  background: var(--color-bg-primary);
  border-radius: var(--border-radius-lg);
  padding: var(--space-lg);
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  scrollbar-gutter: stable;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  box-shadow: var(--shadow-lg);
  border: 2px solid var(--color-border);
}

.preset-modal-header,
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-sm);
  border-bottom: 2px solid var(--color-border);
}

.preset-modal-title {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0;
}

.preset-modal-close,
.modal-close {
  background: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-xs);
  line-height: 1;
  min-width: 32px;
  min-height: 32px;
  border-radius: var(--border-radius-sm);
}

.preset-modal-close:hover,
.modal-close:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
}

.preset-modal-close:focus,
.modal-close:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.preset-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.preset-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  gap: var(--space-md);
}

.preset-item-info {
  flex: 1;
  min-width: 0;
}

.preset-item-name {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  margin: 0 0 var(--space-xs) 0;
  word-break: break-word;
}

.preset-item-meta {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
}

.preset-item-actions {
  display: flex;
  gap: var(--space-xs);
  flex-shrink: 0;
}

.preset-empty {
  text-align: center;
  padding: var(--space-xl);
  color: var(--color-text-secondary);
  font-style: italic;
}

.preset-modal-footer {
  display: flex;
  gap: var(--space-sm);
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
  flex-wrap: wrap;
}

/* Confirm Dialog (COGA compliant) */
.confirm-modal .confirm-modal-content {
  max-width: 420px;
}

.confirm-modal-body {
  padding: var(--space-md) 0;
}

.confirm-modal-body p {
  margin: 0;
  line-height: 1.6;
  color: var(--color-text-primary);
}

.confirm-modal .preset-form-actions {
  justify-content: flex-end;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
}

/* Save Preset Form */
.preset-form {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.preset-form-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.preset-form-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

.preset-form-input,
.preset-form-textarea {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  min-height: 44px;
}

.preset-form-textarea {
  min-height: 80px;
  resize: vertical;
}

.preset-form-input:focus,
.preset-form-textarea:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.preset-form-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: italic;
}

.preset-form-actions {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
  flex-wrap: wrap;
}

@media (max-width: 768px) {
  .preset-modal {
    padding: var(--space-sm);
    padding-top: calc(var(--space-sm) + env(safe-area-inset-top, 0px));
    padding-bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    padding-left: calc(var(--space-sm) + env(safe-area-inset-left, 0px));
    padding-right: calc(var(--space-sm) + env(safe-area-inset-right, 0px));
  }

  .preset-modal-content {
    padding: var(--space-md);
    max-height: 90vh;
  }

  .preset-item {
    flex-direction: column;
    align-items: stretch;
  }

  .preset-item-actions {
    justify-content: flex-end;
  }

  .preset-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .preset-select {
    width: 100%;
  }
}

/* Dimensions Display */
.dimensions-display {
  margin-top: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.dimensions-display.hidden {
  display: none;
}

.dimensions-heading {
  margin: 0 0 var(--space-sm) 0;
  font-size: var(--font-size-base);
  font-weight: 600;
  color: var(--color-text-primary);
}

.dimensions-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-sm);
  margin: 0;
}

.dimension-item {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  padding: var(--space-xs) 0;
}

.dimension-item dt {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  font-weight: 500;
}

.dimension-item dd {
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  margin: 0;
  font-weight: 600;
  font-family: var(--font-family-mono);
}

/* Mobile: stack dimensions vertically */
@media (max-width: 768px) {
  .dimensions-list {
    grid-template-columns: 1fr;
  }
}

/* ========================================
   Comparison View
   ======================================== */

.comparison-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: var(--space-md);
  padding-top: calc(var(--space-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom, 0px));
  padding-left: calc(var(--space-md) + env(safe-area-inset-left, 0px));
  padding-right: calc(var(--space-md) + env(safe-area-inset-right, 0px));
  background: var(--color-bg-primary);
  overflow: hidden;
}

.comparison-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-md);
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-md);
  border-bottom: 2px solid var(--color-border);
}

.comparison-header h2 {
  margin: 0;
  font-size: var(--font-size-xl);
  color: var(--color-text-primary);
}

.comparison-controls {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: var(--space-md);
  flex: 1;
  overflow-y: auto;
  padding: var(--space-sm);
  scrollbar-gutter: stable;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* WebKit scrollbar dark mode contrast */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .comparison-grid::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  :root:not([data-theme='light'])
    .comparison-grid::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-text-secondary);
  }
}

:root[data-theme='dark'] .comparison-grid::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.35);
}

:root[data-theme='dark'] .comparison-grid::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}

/* Dark mode scrollbar contrast (Firefox) */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .comparison-grid {
    scrollbar-color: var(--color-border) transparent;
  }
}

:root[data-theme='dark'] .comparison-grid {
  scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
}

.comparison-empty-state {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
  text-align: center;
}

/* Variant Card */
.variant-card {
  display: flex;
  flex-direction: column;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  box-shadow: var(--shadow-sm);
  transition: box-shadow 0.2s;
}

.variant-card:hover {
  box-shadow: var(--shadow-md);
}

.variant-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.variant-name-input {
  flex: 1;
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  padding: var(--space-xs);
  transition: border-color 0.2s;
}

.variant-name-input:hover {
  border-bottom-color: var(--color-border);
}

.variant-name-input:focus {
  outline: none;
  border-bottom-color: var(--color-accent);
}

.variant-actions {
  display: flex;
  gap: var(--space-xs);
}

.btn-icon {
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-xs);
  font-size: var(--size-icon-md);
  min-width: 36px;
  min-height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-icon:hover:not(:disabled) {
  background: var(--color-accent);
  border-color: var(--color-accent);
  transform: scale(1.1);
}

.btn-icon:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.btn-icon:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* Variant Preview */
.variant-preview {
  position: relative;
  width: 100%;
  height: 300px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-sm);
  overflow: hidden;
}

/* Variant Status */
.variant-status {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  align-items: center;
  padding: var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
}

.status-label {
  font-weight: 600;
}

.status-stats {
  color: var(--color-text-secondary);
  font-family: var(--font-family-mono);
}

.status-error {
  color: var(--color-error);
  font-weight: 500;
}

/* Variant States */
.variant-state-pending .status-label {
  color: var(--color-text-secondary);
}

.variant-state-rendering .status-label {
  color: var(--color-text-primary);
  animation: pulse 1.5s ease-in-out infinite;
}

.variant-state-complete {
  border-color: var(--color-success);
}

.variant-state-complete .status-label {
  color: var(--color-success);
}

.variant-state-error {
  border-color: var(--color-error);
  background: rgba(220, 53, 69, 0.1);
}

.variant-state-error .status-label {
  color: var(--color-error);
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .comparison-grid {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  }
}

@media (max-width: 768px) {
  .comparison-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .comparison-controls {
    width: 100%;
  }

  .comparison-controls .btn {
    flex: 1;
    min-width: 0;
    font-size: var(--font-size-sm);
  }

  .comparison-grid {
    grid-template-columns: 1fr;
  }

  .variant-card {
    padding: var(--space-sm);
  }

  .variant-preview {
    height: 250px;
  }

  .variant-actions {
    flex-wrap: wrap;
  }
}

/* High Contrast Mode */
[data-high-contrast='true'] .variant-card {
  border-width: 2px;
}

[data-high-contrast='true'] .variant-state-complete {
  border-width: 3px;
}

[data-high-contrast='true'] .variant-state-error {
  border-width: 3px;
}

[data-high-contrast='true'] .btn-icon {
  border-width: 2px;
  font-weight: 700;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .variant-card {
    transition: none;
  }

  .btn-icon {
    transition: none;
  }

  .variant-state-rendering .status-label {
    animation: none;
  }
}

/* ============================================================================
   Library Controls
   ============================================================================ */

.library-controls {
  margin-bottom: var(--space-md);
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  background: var(--color-bg-secondary);
}

.library-details {
  position: relative;
}

.library-summary {
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm);
  font-weight: 600;
  color: var(--color-text-primary);
  border-radius: var(--border-radius-sm);
  transition: background-color 0.2s;
  list-style: none;
}

.library-summary::-webkit-details-marker {
  display: none;
}

.library-summary::before {
  content: '▶';
  display: inline-block;
  transition: transform 0.2s;
  font-size: 0.8em;
}

.library-details[open] .library-summary::before {
  transform: rotate(90deg);
}

.library-summary:hover {
  background: var(--color-bg-primary);
}

.library-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.library-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 24px;
  height: 24px;
  padding: 0 var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border-radius: var(--border-radius-lg);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.library-content {
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.library-help {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-md);
}

.library-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.library-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: all 0.2s;
  min-height: var(--size-touch-target);
}

.library-item:hover {
  background: var(--color-bg-secondary);
  box-shadow: var(--shadow-sm);
}

.library-item:has(input:checked) {
  border-color: var(--color-accent);
  background: rgba(0, 102, 204, 0.05);
}

.library-item:has(input:focus) {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.library-detected {
  border-color: var(--color-warning);
  border-width: 2px;
}

.library-item input[type='checkbox'] {
  width: 20px;
  height: 20px;
  margin: 0;
  cursor: pointer;
  accent-color: var(--color-accent);
}

.library-icon {
  font-size: var(--size-icon-lg);
  flex-shrink: 0;
  line-height: 1;
}

.library-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--space-2xs);
  min-width: 0;
}

.library-name {
  font-weight: 600;
  color: var(--color-text-primary);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
}

.library-required-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-warning);
  color: var(--color-on-warning);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.library-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.3;
}

.library-footer {
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
}

.btn-link {
  background: none;
  border: none;
  color: var(--color-text-primary);
  text-decoration-color: var(--color-accent);
  cursor: pointer;
  text-decoration: underline;
  font-size: var(--font-size-sm);
  padding: var(--space-xs);
  transition: color 0.2s;
}

.btn-link-with-icon {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2xs);
}

.btn-link:hover {
  color: var(--color-text-primary);
  text-decoration-color: var(--color-accent-hover);
}

.btn-link:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* High Contrast Mode */
[data-high-contrast='true'] .library-controls {
  border-width: 2px;
}

[data-high-contrast='true'] .library-item {
  border-width: 2px;
}

[data-high-contrast='true'] .library-detected {
  border-width: 3px;
}

[data-high-contrast='true'] .library-badge {
  font-weight: 700;
}

[data-high-contrast='true'] .library-required-badge {
  font-weight: 900;
}

/* Responsive Design */
@media (max-width: 768px) {
  .library-item {
    padding: var(--space-xs);
  }

  .library-icon {
    font-size: var(--size-icon-md);
  }

  .library-name {
    font-size: var(--font-size-sm);
  }

  .library-description {
    font-size: var(--font-size-2xs);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .library-summary,
  .library-item {
    transition: none;
  }

  .library-summary::before {
    transition: none;
  }
}

/* =========================================
   Color Picker Control
   ========================================= */

.param-control--color {
  margin-bottom: var(--space-md);
}

.color-picker-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-xs);
}

.color-preview {
  width: 44px;
  height: 44px;
  border-radius: var(--border-radius-sm);
  border: 2px solid var(--color-border);
  box-shadow: var(--shadow-sm);
  transition: border-color 0.2s;
}

.color-preview:hover {
  border-color: var(--color-accent);
}

.color-picker {
  width: 64px;
  height: 44px;
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  background: none;
  padding: var(--space-2xs);
  transition: border-color 0.2s;
}

.color-picker:hover {
  border-color: var(--color-accent);
}

.color-picker:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

/* Remove default color input styling in WebKit browsers */
.color-picker::-webkit-color-swatch-wrapper {
  padding: 0;
}

.color-picker::-webkit-color-swatch {
  border: none;
  border-radius: var(--border-radius-sm);
}

.color-hex-input {
  width: 90px;
  padding: var(--space-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-base);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  text-transform: uppercase;
  transition: border-color 0.2s;
}

.color-hex-input:hover {
  border-color: var(--color-accent);
}

.color-hex-input:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

.color-hex-input::placeholder {
  color: var(--color-text-secondary);
}

/* High Contrast Mode */
[data-high-contrast='true'] .color-preview {
  border-width: 3px;
}

[data-high-contrast='true'] .color-picker {
  border-width: 3px;
}

[data-high-contrast='true'] .color-hex-input {
  border-width: 3px;
}

/* Responsive */
@media (max-width: 768px) {
  .color-picker-container {
    flex-wrap: wrap;
  }

  .color-preview {
    width: 40px;
    height: 40px;
  }

  .color-picker {
    width: 56px;
    height: 40px;
  }

  .color-hex-input {
    width: 100%;
    flex: 1 1 100%;
  }
}

/* =========================================
   File Upload Control
   ========================================= */

.param-control--file {
  margin-bottom: var(--space-md);
}

.file-upload-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-xs);
  flex-wrap: wrap;
}

.file-input {
  /* Hide the actual file input */
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.file-upload-button {
  padding: var(--space-sm) var(--space-md);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  font-weight: 500;
  cursor: pointer;
  min-height: 44px;
  transition:
    background-color 0.2s,
    transform 0.1s;
}

.file-upload-button:hover {
  background: var(--color-accent-hover);
}

.file-upload-button:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.file-upload-button:active {
  transform: translateY(1px);
}

.file-info {
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  line-height: 1.4;
}

.file-info-summary {
  min-width: 0;
  word-wrap: break-word;
}

.file-info-details {
  font-size: var(--font-size-xs);
}

.file-info-details summary {
  cursor: pointer;
  user-select: none;
  color: var(--color-text-primary);
  padding: var(--space-xs) 0;
  font-size: var(--font-size-xs);
}

.file-info-details summary:hover {
  text-decoration: underline;
}

.file-info-details summary:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.file-info-tree {
  margin-top: var(--space-xs);
  font-family: monospace;
  font-size: var(--font-size-xs);
  white-space: pre-wrap;
  overflow-x: auto;
}

.file-info--error {
  background: rgba(220, 53, 69, 0.1);
  color: var(--color-error);
  border-color: var(--color-error);
}

.file-clear-button {
  width: 44px;
  height: 44px;
  background: var(--color-error);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-lg);
  cursor: pointer;
  transition:
    background-color 0.2s,
    transform 0.1s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.file-clear-button:hover {
  background: var(--color-error-hover);
}

.file-clear-button:focus {
  outline: 3px solid var(--color-error);
  outline-offset: 2px;
}

.file-clear-button:active {
  transform: translateY(1px);
}

/* High Contrast Mode */
[data-high-contrast='true'] .file-upload-button {
  border: 2px solid currentColor;
}

[data-high-contrast='true'] .file-info {
  border-width: 3px;
}

[data-high-contrast='true'] .file-clear-button {
  border: 2px solid currentColor;
}

/* Responsive */
@media (max-width: 768px) {
  .file-upload-container {
    flex-direction: column;
    align-items: stretch;
  }

  .file-upload-button,
  .file-info,
  .file-clear-button {
    width: 100%;
  }

  .file-clear-button {
    width: auto;
  }
}

@media (max-height: 720px) {
  .upload-zone {
    padding: var(--space-lg);
  }

  .features-overview {
    margin-top: var(--space-lg);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .color-preview,
  .color-picker,
  .color-hex-input,
  .file-upload-button,
  .file-clear-button {
    transition: none;
  }
}

/* =========================================
   Render Queue
   ========================================= */

.queue-badge {
  display: inline-block;
  min-width: 20px;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-accent);
  color: var(--color-on-accent);
  border-radius: var(--radius-md);
  font-size: var(--font-size-2xs);
  font-weight: 700;
  line-height: 1;
  text-align: center;
  vertical-align: middle;
  margin-left: var(--space-xs);
}

.queue-controls {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
}

.queue-stats {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
  font-size: var(--font-size-sm);
}

.queue-stat {
  color: var(--color-text-secondary);
}

.queue-stat strong {
  color: var(--color-text-primary);
  font-weight: 600;
  margin-left: var(--space-xs);
}

.queue-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  max-height: 500px;
  overflow-y: auto;
  padding: var(--space-sm);
}

.queue-empty {
  text-align: center;
  padding: var(--space-xl);
  color: var(--color-text-secondary);
}

.queue-empty p {
  margin: var(--space-sm) 0;
}

.queue-empty-hint {
  font-size: var(--font-size-sm);
  opacity: 0.7;
}

.queue-item {
  background: var(--color-bg-primary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.queue-item:hover {
  border-color: var(--color-accent);
  box-shadow: var(--shadow-md);
}

.queue-item-queued {
  border-left: 4px solid var(--color-warning);
}

.queue-item-rendering {
  border-left: 4px solid var(--color-accent);
  background: var(--color-bg-secondary);
}

.queue-item-complete {
  border-left: 4px solid var(--color-success);
}

.queue-item-error {
  border-left: 4px solid var(--color-error);
}

.queue-item-cancelled {
  border-left: 4px solid var(--color-text-secondary);
  opacity: 0.7;
}

.queue-item-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  flex-wrap: wrap;
}

.queue-item-icon {
  font-size: var(--size-icon-md);
  line-height: 1;
}

.queue-item-name {
  flex: 1;
  font-weight: 600;
  color: var(--color-text-primary);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.queue-item-name[contenteditable='true'] {
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  cursor: text;
}

.queue-item-name[contenteditable='true']:hover {
  background: var(--color-bg-secondary);
}

.queue-item-name[contenteditable='true']:focus {
  outline: 2px solid var(--color-focus);
  background: var(--color-bg-primary);
}

.queue-item-format {
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
}

.queue-item-state {
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  text-transform: capitalize;
}

.queue-item-queued .queue-item-state {
  background: var(--color-warning-bg);
  color: var(--color-warning-text);
}

.queue-item-rendering .queue-item-state {
  background: var(--color-accent-subtle);
  color: var(--color-accent-text);
}

.queue-item-complete .queue-item-state {
  background: var(--color-success-bg);
  color: var(--color-success-text);
}

.queue-item-error .queue-item-state {
  background: var(--color-error-bg);
  color: var(--color-error-text);
}

.queue-item-cancelled .queue-item-state {
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
}

.queue-item-body {
  margin-bottom: var(--space-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.queue-item-error {
  color: var(--color-error);
  margin-bottom: var(--space-xs);
}

.queue-item-time,
.queue-item-stats {
  margin-bottom: var(--space-xs);
}

.queue-item-actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
}

.queue-item-actions .btn {
  min-height: 36px;
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
}

/* High Contrast Mode */
[data-high-contrast='true'] .queue-item {
  border-width: 3px;
}

[data-high-contrast='true'] .queue-item-queued {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-rendering {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-complete {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-error {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-cancelled {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-badge {
  font-weight: 900;
  border: 2px solid white;
}

/* Responsive */
@media (max-width: 768px) {
  .queue-controls {
    padding: var(--space-sm);
  }

  .queue-stats {
    padding: var(--space-sm);
    gap: var(--space-sm);
  }

  .queue-item {
    padding: var(--space-sm);
  }

  .queue-item-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .queue-item-name {
    width: 100%;
  }

  .queue-item-actions {
    width: 100%;
  }

  .queue-item-actions .btn {
    flex: 1 1 auto;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .queue-item {
    transition: none;
  }
}

/* =========================================
   LOD (Level of Detail) Warning
   ========================================= */

.lod-warning {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--color-bg-elevated);
  border: 2px solid var(--color-warning);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  max-width: 320px;
  width: 90%;
  z-index: 100;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  animation: lodFadeIn 0.2s ease-out;
}

.lod-warning--critical {
  border-color: var(--color-error);
  background: var(--color-bg-elevated);
}

@keyframes lodFadeIn {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.lod-warning-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.lod-warning-icon {
  font-size: 1.25rem;
}

.lod-warning-title {
  font-size: var(--font-size-md);
  color: var(--color-text-primary);
}

.lod-warning-content {
  margin-bottom: var(--space-md);
}

.lod-warning-message {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-xs);
}

.lod-warning-stats {
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  background: var(--color-bg-secondary);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  text-align: center;
}

.lod-warning-stats strong {
  color: var(--color-warning);
}

.lod-warning--critical .lod-warning-stats strong {
  color: var(--color-error);
}

.lod-warning-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-sm);
}

/* High Contrast Mode */
[data-high-contrast='true'] .lod-warning {
  border-width: 3px;
}

[data-high-contrast='true'] .lod-warning--critical {
  border-color: var(--color-error);
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .lod-warning {
    animation: none;
  }
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .lod-warning {
    max-width: 95%;
    padding: var(--space-sm);
  }

  .lod-warning-stats {
    font-size: var(--font-size-xs);
  }
}

/* =========================================
   Memory Warning Notification
   ========================================= */

.memory-warning {
  position: fixed;
  bottom: calc(var(--space-lg) + env(safe-area-inset-bottom, 0px));
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  max-width: 400px;
  width: calc(100% - 2 * var(--space-md));
  padding: var(--space-md);
  background: var(--color-bg-elevated);
  border: 2px solid var(--color-warning);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.memory-warning-content {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
}

.memory-warning-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.memory-warning-text {
  flex: 1;
}

.memory-warning-text strong {
  display: block;
  color: var(--color-warning);
  font-size: var(--font-size-md);
  margin-bottom: var(--space-xs);
}

.memory-warning-text p {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin: 0;
}

.memory-warning-hint {
  margin-top: var(--space-xs) !important;
  font-style: italic;
}

.memory-warning-dismiss {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  line-height: 1;
}

/* High Contrast Mode */
[data-high-contrast='true'] .memory-warning {
  border-width: 3px;
  border-color: var(--color-warning);
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .memory-warning {
    max-width: calc(100% - 2 * var(--space-sm));
    bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    padding: var(--space-sm);
  }

  .memory-warning-icon {
    font-size: 1.25rem;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .memory-warning {
    animation: none;
  }
}

/* =========================================
   Advanced Menu
   ========================================= */

.advanced-menu {
  margin-top: var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  background: var(--color-bg-secondary);
}

.advanced-menu-summary {
  padding: var(--space-sm) var(--space-md);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  font-weight: 500;
  color: var(--color-text-secondary);
  transition:
    color 0.2s,
    background-color 0.2s;
  user-select: none;
}

.advanced-menu-summary:hover {
  color: var(--color-text-primary);
  background: var(--color-bg-tertiary);
}

.advanced-menu-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.advanced-menu[open] .advanced-menu-summary {
  border-bottom: 1px solid var(--color-border);
}

.advanced-icon {
  font-size: 1.1rem;
}

.advanced-menu-content {
  padding: var(--space-md);
}

.advanced-section {
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-md);
  border-bottom: 1px solid var(--color-border);
}

.advanced-section:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.advanced-section-title {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-sm) 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.advanced-btn {
  margin-right: var(--space-xs);
  margin-bottom: var(--space-xs);
}

.advanced-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  cursor: pointer;
  font-size: var(--font-size-sm);
}

.advanced-toggle input[type='checkbox'] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.advanced-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-muted);
  margin: var(--space-xs) 0 0 0;
  font-style: italic;
}

.reset-tools {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
}

.reset-group-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
}

.reset-group-selector label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.reset-group-select {
  flex: 1;
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

/* =========================================
   Source Code Viewer Modal
   ========================================= */

.modal-source {
  max-width: 900px;
  width: min(92vw, 900px);
  height: 80vh;
  display: flex;
  flex-direction: column;
}

.source-viewer-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.source-viewer-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.source-viewer-textarea {
  flex: 1;
  width: 100%;
  min-height: clamp(12rem, 40vh, 18.75rem);
  padding: var(--space-md);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  resize: vertical;
  tab-size: 2;
  white-space: pre;
  overflow: auto;
}

.source-viewer-textarea:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: -2px;
}

.source-viewer-info {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: var(--space-sm);
}

.source-viewer-info span {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

/* =========================================
   Parameters JSON Viewer Modal
   ========================================= */

.modal-medium {
  max-width: 600px;
  width: min(92vw, 600px);
}

.params-json-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.params-json-textarea {
  width: 100%;
  min-height: clamp(12rem, 40vh, 18.75rem);
  max-height: min(70vh, 500px);
  padding: var(--space-md);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  resize: vertical;
  tab-size: 2;
  white-space: pre;
  overflow: auto;
}

.params-json-textarea:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: -2px;
}

/* =========================================
   Parameter Limits Override Indicator
   ========================================= */

.param-control.limits-unlocked .slider-container input[type='range'],
.param-control.limits-unlocked .number-input-container input[type='number'] {
  border-color: var(--color-warning);
  box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.2);
}

.param-unlocked-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  margin-left: var(--space-xs);
}

.param-unlocked-indicator::before {
  content: '🔓';
}

/* Warning for out-of-range values */
.param-control.out-of-range .slider-value,
.param-control.out-of-range input[type='number'] {
  color: var(--color-warning);
  font-weight: 600;
}

.param-out-of-range-warning {
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  margin-top: var(--space-xs);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.param-out-of-range-warning::before {
  content: '⚠️';
}

/* =========================================
   Individual Parameter Reset Button
   ========================================= */

.param-reset-btn {
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-xs);
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary); /* Ensure this adapts to theme */
  cursor: pointer;
  opacity: 0;
  transition:
    opacity 0.2s,
    color 0.2s,
    border-color 0.2s;
  margin-left: auto;
}

.param-control:hover .param-reset-btn,
.param-control:focus-within .param-reset-btn {
  opacity: 1;
}

.param-reset-btn:hover {
  color: var(--color-text-primary);
  border-color: var(--color-accent);
}

.param-reset-btn:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 1px;
  opacity: 1;
}

.param-reset-btn.modified {
  opacity: 1;
  color: var(--color-text-primary);
  border-color: var(--color-accent);
}

/* High Contrast Mode */
[data-high-contrast='true'] .advanced-menu {
  border-width: 2px;
}

[data-high-contrast='true'] .source-viewer-textarea,
[data-high-contrast='true'] .params-json-textarea {
  border-width: 2px;
}

[data-high-contrast='true']
  .param-control.limits-unlocked
  .slider-container
  input[type='range'],
[data-high-contrast='true']
  .param-control.limits-unlocked
  .number-input-container
  input[type='number'] {
  border-width: 3px;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .modal-source {
    height: 90vh;
    max-width: 100%;
    margin: var(--space-sm);
  }

  .source-viewer-textarea {
    font-size: var(--font-size-xs);
  }

  .reset-group-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .reset-group-selector label {
    margin-bottom: var(--space-xs);
  }
}

/* WASM Loading Overlay */
.wasm-loading-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-primary);
  opacity: 1;
  transition: opacity 0.3s ease-out;
}

.wasm-loading-overlay.fade-out {
  opacity: 0;
  pointer-events: none;
}

.wasm-loading-content {
  text-align: center;
  max-width: 400px;
  padding: var(--space-xl);
}

.wasm-loading-spinner {
  margin-bottom: var(--space-lg);
}

.wasm-loading-spinner .spinner-large {
  width: 64px;
  height: 64px;
  border-width: 5px;
}

.wasm-loading-title {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.wasm-loading-message {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-md) 0;
  min-height: 1.5em;
}

.wasm-loading-progress-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.wasm-loading-progress-bar {
  flex: 1;
  height: 8px;
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  overflow: hidden;
}

.wasm-loading-progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: var(--border-radius-sm);
  transition: width 0.3s ease-out;
}

.wasm-loading-progress-fill.indeterminate {
  width: 30% !important;
  animation: indeterminateProgress 1.5s ease-in-out infinite;
}

@keyframes indeterminateProgress {
  0% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(200%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.wasm-loading-progress-text {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-primary);
  min-width: 40px;
  text-align: right;
}

.wasm-loading-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  margin: 0;
}

/* High Contrast Mode for WASM Loading */
[data-high-contrast='true'] .wasm-loading-progress-bar {
  border: 2px solid var(--color-text-primary);
}

/* Reduced Motion for WASM Loading */
@media (prefers-reduced-motion: reduce) {
  .wasm-loading-progress-fill.indeterminate {
    animation: none;
    width: 50% !important;
  }
}

/* ========== FEATURES GUIDE MODAL ========== */

.features-guide-body {
  display: flex;
  flex-direction: column;
  gap: 0; /* Remove gap, let children handle spacing */
  max-height: min(70vh, 600px);
  max-height: min(70dvh, 600px); /* Dynamic viewport height */
  overflow: hidden;
}

/* Tab bar stays fixed at top of modal body */
.features-tabs {
  display: flex;
  gap: var(--space-xs);
  border-bottom: 2px solid var(--color-border);
  flex-shrink: 0; /* Don't shrink */
  overflow-x: auto; /* Horizontal scroll if needed */
  overflow-y: hidden;
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
  /* Ensure tabs don't wrap into tiny unusable sizes */
  flex-wrap: nowrap;
  padding: 0 var(--space-sm);
}

/* Scroll indicator for tabs */
.features-tabs::after {
  content: '';
  position: sticky;
  right: 0;
  width: 20px;
  background: linear-gradient(to left, var(--color-bg-primary), transparent);
  flex-shrink: 0;
  pointer-events: none;
}

.features-tab {
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--color-text-secondary);
  font-weight: 500;
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  min-width: 80px; /* Minimum width so tabs aren't too small */
  white-space: nowrap;
  flex-shrink: 0; /* Don't shrink individual tabs */
  transition:
    color 0.2s,
    border-color 0.2s,
    background-color 0.2s;
}

.features-tab:hover {
  color: var(--color-text-primary);
  background-color: var(--color-hover-bg);
}

.features-tab:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
  z-index: 1;
}

.features-tab[aria-selected='true'] {
  color: var(--color-text-primary);
  border-bottom-color: var(--color-accent);
  font-weight: 600;
}

/* Panel scrolls independently */
.features-panel {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-lg);
  outline: none;
  min-height: 0; /* Required for flex child scrolling */
}

.features-panel h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-md) 0;
}

.features-panel h4 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: var(--space-lg) 0 var(--space-sm) 0;
}

.features-panel p {
  margin: var(--space-sm) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.features-panel pre {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-md);
  overflow-x: auto;
  margin: var(--space-md) 0;
}

.features-panel code {
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
}

.features-panel p code {
  background: var(--color-bg-secondary);
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-xs);
  font-size: 0.9em;
}

.features-list {
  margin: var(--space-sm) 0;
  padding-left: var(--space-lg);
  line-height: 1.8;
}

.features-list li {
  margin: var(--space-xs) 0;
  color: var(--color-text-secondary);
}

.features-list strong {
  color: var(--color-text-primary);
  font-weight: 600;
}

.features-action {
  margin: var(--space-lg) 0;
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  border-left: 4px solid var(--color-accent);
}

.features-note {
  margin: var(--space-sm) 0 0 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  font-style: italic;
}

/* Modal size variant for Features Guide */
.modal-large {
  max-width: 900px;
  width: 90vw;
}

/* Ensure modal content is always opaque */
.modal-content {
  background-color: var(--color-bg-primary);
  opacity: 1;
}

/* Override any inherited transparency */
#featuresGuideModal .modal-content {
  background-color: var(--color-bg-primary);
  opacity: 1;
}

/* High Contrast for Features Guide */
[data-high-contrast='true'] .features-tabs {
  border-bottom-width: 3px;
}

[data-high-contrast='true'] .features-tab[aria-selected='true'] {
  border-bottom-width: 4px;
}

[data-high-contrast='true'] .features-panel pre {
  border-width: 2px;
}

[data-high-contrast='true'] .features-action {
  border-width: 2px;
  border-left-width: 6px;
}

/* =========================================
   Features Guide - Tutorial Highlight Polish
   Enhanced styling when modal is spotlighted
   ========================================= */

/* Enhanced header when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .modal-header {
  background: linear-gradient(
    135deg,
    var(--color-accent) 0%,
    color-mix(in srgb, var(--color-accent) 80%, var(--color-bg-primary)) 100%
  );
  color: var(--color-accent-text, white);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  padding: var(--space-md) var(--space-lg);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .modal-header h2 {
  color: inherit;
}

#featuresGuideModal .modal-content.tutorial-target-highlight .modal-close {
  color: inherit;
  opacity: 0.9;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .modal-close:hover {
  opacity: 1;
  background: rgba(255, 255, 255, 0.2);
}

/* Make close button more prominent during tutorial - pulsing hint */
#featuresGuideModal .modal-content.tutorial-target-highlight .modal-close {
  animation: closeButtonHint 2s ease-in-out infinite;
  position: relative;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .modal-close::after {
  content: 'Close to continue';
  position: absolute;
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: var(--space-sm);
  white-space: nowrap;
  font-size: var(--font-size-xs);
  font-weight: 500;
  opacity: 0.9;
  pointer-events: none;
}

@keyframes closeButtonHint {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

/* Enhanced tabs when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .features-tabs {
  position: relative;
  background: var(--color-bg-secondary);
  border-bottom: 2px solid var(--color-accent);
  padding-top: var(--space-lg);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .features-tab {
  font-weight: 600;
  transition: all 0.2s ease;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tab:hover {
  background: color-mix(in srgb, var(--color-accent) 15%, transparent);
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tab[aria-selected='true'] {
  color: var(--color-text-primary);
  border-bottom-color: var(--color-accent);
  background: color-mix(
    in srgb,
    var(--color-accent) 10%,
    var(--color-bg-primary)
  );
}

/* Enhanced panel content when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .features-panel {
  background: var(--color-bg-primary);
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-panel
  h3 {
  color: var(--color-text-primary);
  border-bottom: 2px solid var(--color-accent);
  padding-bottom: var(--space-xs);
  margin-bottom: var(--space-md);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .features-action {
  border-color: var(--color-accent);
  background: color-mix(
    in srgb,
    var(--color-accent) 8%,
    var(--color-bg-secondary)
  );
}

/* Encourage exploration - hint above tabs */
#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tabs::before {
  content: '👆 Explore the tabs to learn more';
  position: absolute;
  left: var(--space-sm);
  top: var(--space-2xs);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
  font-style: italic;
}

/* Tutorial panel positioning when Features Guide modal is open */
body:has(#featuresGuideModal:not(.hidden)) .tutorial-panel {
  /* Position at bottom of screen when modal is open */
  position: fixed !important;
  bottom: var(--space-md) !important;
  left: 50% !important;
  top: auto !important;
  transform: translateX(-50%) !important;
  max-width: min(400px, calc(100vw - var(--space-lg) * 2)) !important;
  z-index: 10006 !important;
  box-shadow:
    0 -4px 20px rgba(0, 0, 0, 0.3),
    0 0 0 3px var(--color-accent) !important;
}

/* Hide the arrow when modal is open - panel is detached */
body:has(#featuresGuideModal:not(.hidden)) .tutorial-arrow {
  display: none !important;
}

/* Mobile: adjust panel position when modal is open */
@media (max-width: 767px) {
  body:has(#featuresGuideModal:not(.hidden)) .tutorial-panel {
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    max-width: 100% !important;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0 !important;
    max-height: 35vh !important;
  }
}

/* Responsive adjustments */
@media (max-width: 767px) {
  .features-guide-body {
    max-height: 80vh;
    max-height: 80dvh;
  }

  .modal-large {
    width: 95vw;
    max-width: none;
    margin: var(--space-sm);
  }

  .features-tab {
    padding: var(--space-sm);
    min-width: 70px;
    font-size: var(--font-size-sm);
  }

  .features-panel {
    padding: var(--space-md);
  }
}

/* =========================================
   Camera Controls (WCAG 2.2 SC 2.5.7)
   Non-drag alternatives for 3D preview
   ========================================= */

.camera-controls {
  position: absolute;
  bottom: var(--space-md);
  right: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  z-index: 50;
  background: var(--color-bg-primary);
  padding: var(--space-sm);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-md);
  /* Prevent the panel from exceeding the preview area */
  max-height: calc(100% - (var(--space-md) * 2));
  overflow: auto;
}

.camera-controls-header {
  display: flex;
  gap: var(--space-xs);
  align-items: center;
  justify-content: space-between;
}

.camera-controls-toggle,
.camera-controls-move {
  min-height: 44px;
  padding: 0 var(--space-sm);
  border-radius: var(--border-radius-sm);
  border: 2px solid var(--color-border);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  font-weight: 600;
  cursor: pointer;
}

.camera-controls-toggle {
  flex: 1;
  text-align: left;
}

.camera-controls-toggle:hover,
.camera-controls-move:hover {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-accent-text);
}

.camera-controls-toggle:focus,
.camera-controls-move:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.camera-controls-body {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

/* Collapsed state: keep a small, movable header only */
.camera-controls[data-collapsed='true'] {
  padding: var(--space-xs);
}

/* Position variants (keyboard-accessible “Move” cycles corners) */
.camera-controls[data-position='bottom-right'] {
  bottom: var(--space-md);
  right: var(--space-md);
  top: auto;
  left: auto;
}

.camera-controls[data-position='bottom-left'] {
  bottom: var(--space-md);
  left: var(--space-md);
  top: auto;
  right: auto;
}

.camera-controls[data-position='top-right'] {
  top: var(--space-md);
  right: var(--space-md);
  bottom: auto;
  left: auto;
}

.camera-controls[data-position='top-left'] {
  top: var(--space-md);
  left: var(--space-md);
  bottom: auto;
  right: auto;
}

.camera-control-group {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-xs);
}

.camera-zoom-group {
  grid-template-columns: repeat(3, 1fr);
  padding-top: var(--space-xs);
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-xs);
}

.camera-control-btn {
  width: 44px;
  height: 44px;
  min-width: 44px;
  min-height: 44px;
  padding: 0;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  font-size: var(--font-size-lg);
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.camera-control-btn:hover {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-accent-text);
  transform: scale(1.05);
}

.camera-control-btn:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.camera-control-btn:active {
  transform: scale(0.95);
}

/* Arrange rotation buttons in cross pattern */
.camera-control-group:first-child {
  grid-template-areas:
    '. up .'
    'left . right'
    '. down .';
}

.camera-control-group:first-child button:nth-child(1) {
  grid-area: left;
}

.camera-control-group:first-child button:nth-child(2) {
  grid-area: up;
}

.camera-control-group:first-child button:nth-child(3) {
  grid-area: down;
}

.camera-control-group:first-child button:nth-child(4) {
  grid-area: right;
}

/* Arrange pan buttons in cross pattern */
.camera-pan-group {
  grid-template-areas:
    '. up .'
    'left . right'
    '. down .';
}

.camera-pan-group button:nth-child(1) {
  grid-area: left;
}

.camera-pan-group button:nth-child(2) {
  grid-area: up;
}

.camera-pan-group button:nth-child(3) {
  grid-area: down;
}

.camera-pan-group button:nth-child(4) {
  grid-area: right;
}

/* High Contrast Mode */
[data-high-contrast='true'] .camera-controls {
  border-width: 3px;
}

[data-high-contrast='true'] .camera-control-btn {
  border-width: 3px;
  font-weight: 900;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .camera-controls {
    bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    right: var(--space-sm);
    padding: var(--space-xs);
  }

  .camera-control-btn {
    width: 40px;
    height: 40px;
    min-width: 40px;
    min-height: 40px;
    font-size: var(--font-size-base);
  }
}

/* Hide camera controls in focus mode to avoid clutter */
.main-interface.focus-mode .camera-controls {
  bottom: calc(var(--space-lg) + env(safe-area-inset-bottom, 0px));
  right: var(--space-lg);
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .camera-control-btn {
    transition: none;
  }

  .camera-control-btn:hover {
    transform: none;
  }

  .camera-control-btn:active {
    transform: none;
  }
}

/* ========== WELCOME SCREEN FEATURES OVERVIEW ========== */

.features-overview {
  margin-top: var(--space-xl);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.features-overview h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-lg) 0;
  text-align: center;
}

.feature-cards {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-md);
  margin-bottom: var(--space-lg);
}

.feature-card {
  padding: var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  text-align: center;
  transition:
    transform 0.2s,
    box-shadow 0.2s;
}

.feature-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.feature-card-icon {
  font-size: 2.5rem;
  display: block;
  margin-bottom: var(--space-sm);
  line-height: 1;
}

.feature-card h4 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-xs) 0;
}

.feature-card p {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  line-height: 1.5;
}

.features-overview > .btn {
  display: block;
  margin: 0 auto;
}

/* High Contrast for Feature Cards */
[data-high-contrast='true'] .features-overview {
  border-width: 2px;
}

[data-high-contrast='true'] .feature-card {
  border-width: 2px;
}

/* Responsive for feature cards */
@media (min-width: 768px) {
  .features-overview {
    padding: var(--space-lg);
  }

  .feature-cards {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .role-paths-grid {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  .spotlights-list {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }
}

/* ============================================================================
   Role-Based Feature Paths (Welcome Screen)
   ============================================================================
   New role-based entry points for discovering accessibility features.
   Designed for keyboard-first navigation with large touch targets.
   ============================================================================ */

.features-intro {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  text-align: center;
  margin: 0 0 var(--space-lg) 0;
}

.role-paths-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-lg);
  margin-bottom: var(--space-xl);
}

.role-path-card {
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.role-path-card:focus-within {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
}

.role-path-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0;
  line-height: 1.3;
}

.role-path-description {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin: 0;
  line-height: 1.5;
  /* WCAG AA minimum contrast - text inherits from theme */
}

.role-path-tips {
  list-style: none;
  padding: 0;
  margin: var(--space-sm) 0 0 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  flex: 1;
}

.role-path-tips li {
  padding-left: var(--space-md);
  margin-bottom: var(--space-xs);
  position: relative;
  line-height: 1.5;
}

.role-path-tips li::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--color-text-primary);
  font-weight: bold;
}

.role-path-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-top: auto;
}

.btn-role-try {
  width: 100%;
  justify-content: center;
  font-weight: 600;
  /* Force 44px even on desktop to meet WCAG 2.5.8 AAA for primary CTAs */
  min-height: 44px;
}

.btn-role-learn {
  width: 100%;
  justify-content: center;
  font-size: var(--font-size-sm);
  min-height: 36px;
}

/* Accessibility Spotlights */
.accessibility-spotlights {
  margin-top: var(--space-xl);
  padding-top: var(--space-xl);
  border-top: 1px solid var(--color-border);
}

.spotlights-heading {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-md) 0;
  text-align: center;
}

.spotlights-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-sm);
}

.spotlights-list li {
  margin: 0;
}

.spotlight-link {
  display: block;
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  text-decoration: none;
  font-size: var(--font-size-sm);
  line-height: 1.4;
  min-height: 44px;
  display: flex;
  align-items: center;
  transition:
    background-color 0.2s,
    border-color 0.2s;
}

.spotlight-link:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-accent);
}

.spotlight-link:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* ============================================================================
   Tutorial Overlay System - Spotlight Coachmarks
   ============================================================================
   Modern tutorial system with spotlight cutouts around target elements.
   The tutorial panel positions itself near highlighted elements with an
   arrow pointing to the target. Based on Shepherd.js/Driver.js patterns.
   ============================================================================ */

/* Main overlay container - allows clicks through to spotlight area */
.tutorial-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: var(--z-index-tutorial-backdrop);
  pointer-events: none;
  animation: tutorialFadeIn 0.3s ease-out;
  contain: layout style;
}

/* SVG Spotlight overlay with mask cutout */
.tutorial-spotlight-svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: var(--z-index-tutorial-spotlight);
  contain: strict;
}

.tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.65);
}

.tutorial-spotlight-cutout {
  transition: all 0.3s ease;
}

/* Floating tutorial panel - positioned near target */
.tutorial-panel {
  position: fixed;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-accent);
  border-radius: var(--border-radius-lg);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  width: min(90vw, 340px);
  max-width: calc(100vw - 32px);
  /* dvh-aware max-height with fallback for older browsers */
  max-height: calc(100vh - 32px);
  display: flex;
  flex-direction: column;
  pointer-events: auto;
  animation: tutorialPanelIn 0.3s ease-out;
  outline: none;
  z-index: var(--z-index-tutorial-panel);
  contain: layout style paint;
  content-visibility: auto;
}

/* Use dynamic viewport height on modern browsers */
@supports (max-height: 100dvh) {
  .tutorial-panel {
    max-height: calc(100dvh - 32px);
  }
}

.tutorial-panel:focus {
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 0 0 3px var(--color-focus);
}

.tutorial-panel.tutorial-panel-positioned {
  /* Positioned panels get a subtle entrance */
  animation: tutorialPanelSlide 0.3s ease-out;
}

/* Arrow pointing to target element */
.tutorial-arrow {
  position: absolute;
  width: 16px;
  height: 16px;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-accent);
  transform: rotate(45deg);
  display: none;
}

.tutorial-arrow-top {
  top: -9px;
  border-right: none;
  border-bottom: none;
}

.tutorial-arrow-bottom {
  bottom: -9px;
  border-left: none;
  border-top: none;
}

.tutorial-arrow-left {
  left: -9px;
  border-right: none;
  border-top: none;
}

.tutorial-arrow-right {
  right: -9px;
  border-left: none;
  border-bottom: none;
}

/* Header with title and action buttons */
.tutorial-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md) var(--space-md) var(--space-sm);
  gap: var(--space-sm);
}

.tutorial-title {
  font-size: var(--font-size-sm);
  font-weight: 500;
  color: var(--color-text-secondary);
  margin: 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tutorial-header-actions {
  display: flex;
  gap: var(--space-xs);
}

.tutorial-minimize,
.tutorial-close {
  background: transparent;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: var(--space-xs);
  border-radius: var(--border-radius-sm);
  transition:
    background-color 0.2s,
    color 0.2s;
  min-width: 32px;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tutorial-minimize:hover,
.tutorial-minimize:focus,
.tutorial-close:hover,
.tutorial-close:focus {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  outline: 2px solid var(--color-focus);
  outline-offset: 1px;
}

/* Body content area */
.tutorial-body {
  flex: 1;
  overflow-y: auto;
  padding: 0 var(--space-md) var(--space-md);
}

.tutorial-content {
  color: var(--color-text-primary);
}

.tutorial-step-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.tutorial-step-content {
  font-size: var(--font-size-sm);
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.tutorial-step-content p {
  margin: 0 0 var(--space-sm) 0;
}

.tutorial-step-content p:last-child {
  margin-bottom: 0;
}

.tutorial-step-content ul {
  margin: var(--space-xs) 0;
  padding-left: var(--space-md);
}

.tutorial-step-content li {
  margin-bottom: var(--space-xs);
}

.tutorial-step-content strong {
  color: var(--color-text-primary);
  font-weight: 600;
}

.tutorial-step-content kbd {
  display: inline-block;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  font-family: inherit;
  font-size: 0.85em;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Hint text styling */
.tutorial-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  opacity: 0.8;
  margin-top: var(--space-xs) !important;
}

/* Expandable "more" section for compact content */
.tutorial-more {
  margin-top: var(--space-xs);
  font-size: var(--font-size-xs);
}

.tutorial-more summary {
  cursor: pointer;
  color: var(--color-text-primary);
  font-weight: 500;
  padding: var(--space-2xs) 0;
  list-style: none;
  display: flex;
  align-items: center;
  gap: var(--space-2xs);
}

.tutorial-more summary::-webkit-details-marker {
  display: none;
}

.tutorial-more summary::before {
  content: '▸';
  transition: transform 0.15s ease;
}

.tutorial-more[open] summary::before {
  transform: rotate(90deg);
}

.tutorial-more ul {
  margin: var(--space-xs) 0 0 var(--space-sm);
  padding-left: var(--space-sm);
}

.tutorial-more li {
  margin-bottom: var(--space-2xs);
}

/* Small-height viewport adjustments for tutorial panel */
@media (max-height: 640px) {
  .tutorial-panel {
    max-height: calc(100vh - 16px);
    max-height: calc(100dvh - 16px);
  }

  .tutorial-header {
    padding: var(--space-sm) var(--space-sm) var(--space-xs);
  }

  .tutorial-body {
    padding: 0 var(--space-sm) var(--space-sm);
  }

  .tutorial-step-title {
    font-size: var(--font-size-base);
    margin-bottom: var(--space-xs);
  }

  .tutorial-step-content {
    font-size: var(--font-size-xs);
    line-height: 1.5;
  }

  .tutorial-step-content ul {
    margin: var(--space-2xs) 0;
    padding-left: var(--space-sm);
  }

  .tutorial-step-content li {
    margin-bottom: var(--space-2xs);
  }

  .tutorial-footer {
    padding: var(--space-xs) var(--space-sm);
  }

  .tutorial-keyboard-hint {
    display: none; /* Hide keyboard hints on very small viewports */
  }
}

/* Even smaller viewport - mobile portrait with zoom */
@media (max-height: 520px) {
  .tutorial-panel {
    max-height: calc(100vh - 8px);
    max-height: calc(100dvh - 8px);
    width: min(95vw, 300px);
  }

  .tutorial-header {
    padding: var(--space-xs);
  }

  .tutorial-title {
    font-size: var(--font-size-xs);
  }

  .tutorial-minimize,
  .tutorial-close {
    min-width: 28px;
    min-height: 28px;
    padding: var(--space-2xs);
  }

  .tutorial-body {
    padding: 0 var(--space-xs) var(--space-xs);
    max-height: 50vh;
    overflow-y: auto;
  }

  .tutorial-step-title {
    font-size: var(--font-size-sm);
  }

  .tutorial-nav .btn {
    padding: var(--space-2xs) var(--space-sm);
    font-size: var(--font-size-xs);
  }
}

/* Completion requirement indicator */
.tutorial-requirement {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.1));
  border-left: 3px solid var(--color-warning);
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
  transition: all 0.2s ease;
}

.tutorial-requirement:empty {
  display: none;
}

.tutorial-requirement-done {
  background: var(--color-success-bg, rgba(40, 167, 69, 0.1));
  border-left-color: var(--color-success);
  color: var(--color-success);
}

.tutorial-requirement-pulse {
  animation: requirementPulse 0.5s ease;
}

/* Drawer reopen prompt styling */
.tutorial-requirement-action {
  background: var(--color-info-bg, rgba(23, 162, 184, 0.1));
  border-left-color: var(--color-info, #17a2b8);
}

.tutorial-drawer-prompt {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-2xs);
}

.tutorial-reopen-drawer-btn {
  display: inline-flex;
  align-items: center;
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-xs);
  font-weight: 600;
  background: var(--color-primary);
  color: var(--color-text-on-primary, white);
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.tutorial-reopen-drawer-btn:hover,
.tutorial-reopen-drawer-btn:focus {
  background: var(--color-primary-hover);
  outline: none;
}

.tutorial-reopen-drawer-btn:focus-visible {
  box-shadow: 0 0 0 2px var(--color-focus-ring);
}

/* Footer with navigation */
.tutorial-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-top: 1px solid var(--color-border);
  gap: var(--space-md);
}

.tutorial-progress {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
}

.tutorial-nav {
  display: flex;
  gap: var(--space-sm);
}

/* Tutorial navigation buttons - MUST override reset.css button { background: none; }
   This is critical for accessibility - without explicit colors, Back button is invisible in dark theme */
.tutorial-btn-back,
.tutorial-btn-next {
  min-height: 36px;
  padding: var(--space-xs) var(--space-md);
  font-size: var(--font-size-sm);
  border-radius: var(--border-radius-sm);
  font-weight: 500;
  transition:
    background-color var(--motion-fast),
    border-color var(--motion-fast);
}

/* Back button - secondary style with explicit colors */
.tutorial-btn-back {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-text-primary);
}

.tutorial-btn-back:hover:not(:disabled) {
  background: var(--color-hover-bg);
  border-color: var(--color-border-hover);
}

.tutorial-btn-back:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

/* Next button - primary style with explicit colors */
.tutorial-btn-next {
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: 1px solid var(--color-accent);
}

.tutorial-btn-next:hover:not(:disabled) {
  background: var(--color-accent-hover);
  border-color: var(--color-accent-hover);
}

.tutorial-btn-next:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.tutorial-btn-back:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.tutorial-btn-next:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Keyboard shortcuts hint */
.tutorial-keyboard-hint {
  margin-top: var(--space-sm);
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  text-align: center;
}

.tutorial-keyboard-hint kbd {
  display: inline-block;
  padding: 0.125rem 0.375rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-xs);
  background: var(--color-bg-secondary);
  font-family: var(--font-family-mono);
  font-size: 0.9em;
  line-height: 1;
}

@media (forced-colors: active) {
  .tutorial-keyboard-hint kbd {
    border: 1px solid ButtonText;
  }
}

/* During repositioning, temporarily remove containment for accurate measurements */
.tutorial-panel.measuring {
  contain: none;
  content-visibility: visible;
}

/* Minimized state - floating pill button */
.tutorial-minimized {
  position: fixed;
  bottom: var(--space-lg);
  right: var(--space-lg);
  z-index: var(--z-index-tutorial-minimized);
  pointer-events: auto;
}

.tutorial-restore {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-pill);
  padding: var(--space-sm) var(--space-md);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  transition:
    transform 0.2s,
    box-shadow 0.2s;
  min-height: 44px;
}

.tutorial-restore:hover,
.tutorial-restore:focus {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.tutorial-minimized-text {
  font-weight: 600;
}

.tutorial-minimized-progress {
  background: rgba(255, 255, 255, 0.2);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
}

/* Tutorial keyboard shortcuts: icon-only, expandable */
.tutorial-keyboard-help {
  margin-left: auto;
}

.tutorial-keyboard-help > summary {
  list-style: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 44px;
  min-height: 44px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  cursor: pointer;
}

.tutorial-keyboard-help > summary::-webkit-details-marker {
  display: none;
}

.tutorial-keyboard-help[open] > summary {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.tutorial-keyboard-help-content {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  font-size: var(--font-size-xs);
  line-height: 1.4;
  display: grid;
  gap: var(--space-xs);
}

/* Scroll-margin for elements that can be tutorial targets */
[data-tutorial-target] {
  scroll-margin-top: calc(var(--space-lg) + env(safe-area-inset-top, 0px));
  scroll-margin-bottom: calc(
    var(--space-lg) + 60px
  ); /* Account for mobile actions bar */
}

/* Smooth scrolling during tutorial for targeted elements */
.tutorial-overlay ~ * [data-tutorial-target] {
  scroll-behavior: smooth;
}

/* Highlight ring on target element */
.tutorial-target-highlight {
  outline: 3px solid var(--color-focus) !important;
  outline-offset: 4px !important;
  position: relative;
  z-index: 10001;
  animation: tutorialTargetPulse 2s ease-in-out infinite;
}

/* Prevent scrolling in panels when tutorial is active and highlighting an element */
.tutorial-scroll-locked {
  overflow: hidden !important;
}

/* Ensure modals can appear above tutorial overlay when spotlighted */
.tutorial-target-highlight.modal {
  z-index: 10002 !important;
}

/* Features Guide Modal base styles */
#featuresGuideModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  background: rgba(0, 0, 0, 0.7);
}

/* When Features Guide modal is open during tutorial, bring it above the overlay */
#featuresGuideModal:not(.hidden) {
  z-index: 10003;
}

/* When the Features Guide content is highlighted by tutorial */
#featuresGuideModal .modal-content.tutorial-target-highlight {
  z-index: 10004 !important;
  opacity: 1 !important;
  background: var(--color-bg-primary) !important;
  box-shadow:
    0 12px 48px rgba(0, 0, 0, 0.5),
    0 0 0 4px var(--color-accent),
    0 0 24px rgba(var(--color-accent-rgb, 59, 130, 246), 0.3) !important;
  animation: tutorialModalHighlight 2s ease-in-out infinite !important;
}

/* Override the default outline for modal content - use box-shadow glow instead */
#featuresGuideModal .modal-content.tutorial-target-highlight {
  outline: none !important;
  outline-offset: 0 !important;
}

/* Make the modal overlay semi-transparent when content is spotlighted */
#featuresGuideModal:has(.modal-content.tutorial-target-highlight)
  .modal-overlay {
  background: rgba(0, 0, 0, 0.5);
}

/* Reduce tutorial backdrop when modal content is spotlighted */
body:has(#featuresGuideModal .modal-content.tutorial-target-highlight)
  .tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.4);
}

/* Animation for highlighted modal */
@keyframes tutorialModalHighlight {
  0%,
  100% {
    box-shadow:
      0 12px 48px rgba(0, 0, 0, 0.5),
      0 0 0 4px var(--color-accent),
      0 0 24px rgba(var(--color-accent-rgb, 59, 130, 246), 0.3);
  }
  50% {
    box-shadow:
      0 12px 48px rgba(0, 0, 0, 0.5),
      0 0 0 6px var(--color-accent),
      0 0 32px rgba(var(--color-accent-rgb, 59, 130, 246), 0.5);
  }
}

/* Animations */
@keyframes tutorialTargetPulse {
  0%,
  100% {
    outline-color: var(--color-focus);
    outline-offset: 4px;
  }
  50% {
    outline-color: var(--color-focus);
    outline-offset: 6px;
  }
}

@keyframes tutorialFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes tutorialPanelIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes tutorialPanelSlide {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes requirementPulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
    background: var(--color-warning);
    color: var(--color-accent-text);
  }
}

/* High Contrast Mode */
[data-high-contrast='true'] .tutorial-panel {
  border-width: 3px;
  box-shadow:
    0 0 0 2px var(--color-bg-primary),
    0 8px 32px rgba(0, 0, 0, 0.4);
}

[data-high-contrast='true'] .tutorial-arrow {
  border-width: 3px;
}

[data-high-contrast='true'] .tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.8);
}

[data-high-contrast='true'] .tutorial-restore {
  border: 2px solid white;
}

[data-high-contrast='true'] .tutorial-target-highlight {
  outline-width: 4px !important;
}

/* High Contrast Mode - Tutorial buttons */
[data-high-contrast='true'] .tutorial-btn-back {
  background: var(--color-bg-tertiary);
  border-width: 2px;
  border-color: var(--color-text-primary);
}

[data-high-contrast='true'] .tutorial-btn-next {
  border-width: 2px;
}

/* Forced Colors Mode (Windows High Contrast) - Tutorial buttons */
@media (forced-colors: active) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    border: 2px solid ButtonText !important;
    background: ButtonFace !important;
    color: ButtonText !important;
    forced-color-adjust: none;
  }

  .tutorial-btn-next {
    background: Highlight !important;
    color: HighlightText !important;
    border-color: HighlightText !important;
  }

  .tutorial-btn-back:hover:not(:disabled),
  .tutorial-btn-next:hover:not(:disabled) {
    border-color: Highlight !important;
  }

  .tutorial-btn-back:disabled,
  .tutorial-btn-next:disabled {
    opacity: 1 !important;
    background: GrayText !important;
    color: Canvas !important;
    border-color: GrayText !important;
  }

  .tutorial-spotlight-cutout {
    stroke: Highlight;
    stroke-width: 3px;
  }
}

/* Enhanced Contrast Mode (prefers-contrast: more) - Tutorial */
@media (prefers-contrast: more) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    border-width: 2px;
    font-weight: 600;
  }

  .tutorial-btn-back {
    background: var(--color-bg-tertiary);
    border-color: var(--color-text-primary);
  }

  .tutorial-panel {
    border-width: 3px;
  }

  .tutorial-spotlight-cutout {
    stroke: var(--color-focus);
    stroke-width: 3px;
  }

  .tutorial-target-highlight {
    outline-width: 4px !important;
  }
}

/* Reduced Transparency Mode */
@media (prefers-reduced-transparency: reduce) {
  .tutorial-backdrop {
    backdrop-filter: none !important;
    fill: var(--color-overlay-solid, rgba(0, 0, 0, 0.85)) !important;
  }

  .tutorial-panel {
    background: var(--color-bg-primary) !important;
    border-width: 2px;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .tutorial-overlay,
  .tutorial-panel,
  .tutorial-spotlight-cutout,
  .tutorial-requirement,
  .tutorial-target-highlight {
    animation: none !important;
    transition: none !important;
  }

  .tutorial-restore {
    transition: none;
  }

  /* Disable tutorial arrow bounce */
  .tutorial-arrow {
    animation: none !important;
  }
}

/* Mobile: only dock the panel when NOT positioned near a target.
   When a target is highlighted, allow JS positioning so the panel can move
   out of the way instead of covering the control. */
@media (max-width: 600px) {
  .tutorial-panel:not(.tutorial-panel-positioned) {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    top: auto;
    width: 100%;
    max-width: 100%;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    transform: none;
    max-height: 50vh;
    max-height: 50dvh; /* Dynamic viewport height */
    /* Safe area padding for notched devices (iPhone X+) */
    padding-bottom: max(var(--space-md), env(safe-area-inset-bottom));
  }

  /* On very small screens, arrows tend to overlap. Hide them. */
  .tutorial-arrow {
    display: none;
  }

  .tutorial-minimized {
    bottom: max(var(--space-md), env(safe-area-inset-bottom));
    right: max(var(--space-md), env(safe-area-inset-right));
  }

  .tutorial-footer {
    flex-direction: row;
    padding: var(--space-md);
  }
}

/* Landscape on notched devices */
@media (orientation: landscape) and (max-height: 500px) {
  .tutorial-panel {
    max-width: calc(
      100vw - env(safe-area-inset-left) - env(safe-area-inset-right) -
        var(--space-lg) * 2
    );
    margin-left: max(var(--space-md), env(safe-area-inset-left));
    margin-right: max(var(--space-md), env(safe-area-inset-right));
  }
}

/* Touch device optimizations */
@media (pointer: coarse) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    min-height: 44px;
    min-width: 44px;
    padding: var(--space-sm) var(--space-md);
  }

  /* Touch feedback */
  .tutorial-btn-back:active,
  .tutorial-btn-next:active {
    transform: scale(0.97);
    transition: transform 0.1s ease;
  }

  .tutorial-restore {
    min-height: 48px;
    padding: var(--space-sm) var(--space-lg);
  }
}

/* Prevent text selection during touch interactions on tutorial panel (but allow in content) */
.tutorial-panel {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Body scroll locking when tutorial is active */
body.tutorial-body-locked {
  overflow: hidden;
  position: fixed;
  width: 100%;
  /* top is set dynamically via JS to preserve scroll position */
}

/* Paused tutorial visual feedback (when tab is hidden) */
.tutorial-overlay.tutorial-paused {
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

.tutorial-overlay.tutorial-paused .tutorial-panel {
  pointer-events: none;
}

.tutorial-content,
.tutorial-step-content {
  -webkit-user-select: text;
  user-select: text;
}

/* Tutorial body scrollable for overflow handling */
.tutorial-body {
  overflow-y: auto;
  max-height: 50vh;
  max-height: 50dvh;
}

/* Print styles - hide tutorial completely */
@media print {
  .tutorial-overlay,
  .tutorial-backdrop,
  .tutorial-panel,
  .tutorial-spotlight-svg,
  .tutorial-minimized {
    display: none !important;
  }
}

/* Inverted colors support (iOS/macOS Smart Invert) */
@media (inverted-colors: inverted) {
  .tutorial-backdrop,
  .tutorial-panel {
    filter: invert(0); /* Prevent double-inversion */
  }
}

/* High Contrast Mode: Role Path Cards */
[data-high-contrast='true'] .role-path-card {
  border-width: 3px;
}

[data-high-contrast='true'] .role-path-card:focus-within {
  border-width: 4px;
}

[data-high-contrast='true'] .spotlight-link {
  border-width: 2px;
}

/* Responsive: Stack cards on mobile */
@media (max-width: 768px) {
  .role-paths-grid {
    grid-template-columns: 1fr;
  }

  .spotlights-list {
    grid-template-columns: 1fr;
  }
}

/* Reduced motion: Disable transitions */
@media (prefers-reduced-motion: reduce) {
  .role-path-card {
    transition: none;
  }

  .spotlight-link {
    transition: none;
  }
}

/* ============================================================================
   Forced Colors Mode Adjustments
   ============================================================================
   Component-specific overrides for Windows High Contrast and other
   OS-enforced color schemes to ensure all UI remains usable.
   ============================================================================ */

/* =========================================
   Parameter Search and Navigation (C2)
   ========================================= */

.param-search-section {
  margin-bottom: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.param-search-row {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.param-search-input-wrapper {
  flex: 1;
  min-width: 150px;
  position: relative;
}

.param-search-input {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  padding-right: calc(var(--space-md) + var(--size-touch-target));
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  min-height: 44px;
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.param-search-input:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.param-search-input::placeholder {
  color: var(--color-text-muted);
}

.param-search-clear {
  position: absolute;
  right: var(--space-sm);
  top: 50%;
  transform: translateY(-50%);
  width: var(--size-touch-target);
  height: var(--size-touch-target);
  padding: 0;
  border: none;
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
  font-weight: 700;
  cursor: pointer;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.param-search-clear:hover {
  background: var(--color-accent);
  color: var(--color-accent-text);
}

.param-search-clear:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-jump-wrapper {
  flex: 0 1 180px;
  min-width: 120px;
}

.param-jump-select {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  min-height: 44px;
  cursor: pointer;
  transition: border-color 0.2s;
}

.param-jump-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.param-filter-stats {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.param-filter-stats #paramFilterCount {
  font-weight: 600;
  color: var(--color-text-primary);
}

/* Parameter hidden by search */
.param-control.search-hidden {
  display: none !important;
}

.param-group.search-empty {
  display: none !important;
}

/* Default value display */
.param-default-value {
  font-size: var(--font-size-xs);
  color: var(--color-text-primary);
  margin-left: var(--space-xs);
  font-weight: normal;
}

.param-default-value::before {
  content: '(default: ';
}

.param-default-value::after {
  content: ')';
}

/* =========================================
   Workflow Progress Indicator (C3: COGA)
   ========================================= */

.workflow-progress {
  /* Changed from fixed to sticky */
  position: sticky;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: var(--color-bg-primary);
  border-bottom: 2px solid var(--color-border);
  padding: var(--space-sm) var(--space-md);
  box-shadow: var(--shadow-sm);
  /* Ensure it's within the app flow, not overlaying */
  width: 100%;
  /* Flexbox layout for steps + actions */
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-md);
}

.workflow-steps {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 0;
  margin: 0;
  padding: 0;
  list-style: none;
  flex: 1;
  max-width: 500px;
}

/* Workflow action buttons container */
.workflow-actions {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-shrink: 0;
}

.workflow-actions .btn {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-xs);
  min-height: 32px;
}

.workflow-actions .btn-text {
  display: inline;
}

/* Hide button text on small screens, show only icons */
@media (max-width: 600px) {
  .workflow-actions .btn-text {
    display: none;
  }

  .workflow-actions .btn {
    min-width: 32px;
    padding: var(--space-xs);
  }
}

.workflow-step {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  position: relative;
  flex: 1;
  justify-content: center;
}

.workflow-step-number {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.workflow-step-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
  transition: color 0.3s;
}

/* Active step */
.workflow-step[aria-current='step'],
.workflow-step.active {
  .workflow-step-number {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-on-accent);
  }
  .workflow-step-label {
    color: var(--color-text-primary);
    font-weight: 600;
  }
}

/* Completed step */
.workflow-step.completed {
  .workflow-step-number {
    background: var(--color-success);
    border-color: var(--color-success);
    color: var(--color-on-success);
  }
  .workflow-step-number::after {
    content: '✓';
  }
  .workflow-step-label {
    color: var(--color-text-primary);
    font-weight: 600;
  }
}

.workflow-step.completed::after {
  background: var(--color-success);
}

/* =========================================
   Confirm Modal Styles (COGA)
   ========================================= */

.modal-small {
  max-width: 420px;
  width: min(92vw, 420px);
}

.confirm-modal-content {
  text-align: left;
}

.confirm-modal-body {
  padding: var(--space-md) 0;
}

.confirm-modal-body p {
  margin: 0 0 var(--space-sm) 0;
  line-height: 1.6;
  color: var(--color-text-primary);
}

.confirm-modal-body p:last-child {
  margin-bottom: 0;
}

.confirm-warning {
  /* Higher-contrast warning text on neutral surfaces */
  color: var(--color-warning-text) !important;
  font-weight: 500;
}

.confirm-modal-footer {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
}

/* =========================================
   Plain Language Error Display (C3: COGA)
   ========================================= */

.error-message-friendly {
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-error);
  border-radius: var(--border-radius-md);
  padding: var(--space-lg);
  margin: var(--space-md) 0;
}

.error-message-friendly .error-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-error);
  margin: 0 0 var(--space-sm) 0;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.error-message-friendly .error-explanation {
  font-size: var(--font-size-base);
  color: var(--color-text-primary);
  margin: 0 0 var(--space-md) 0;
  line-height: 1.6;
}

.error-message-friendly .error-suggestion {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
}

.error-message-friendly .error-suggestion strong {
  color: var(--color-text-primary);
}

.error-message-friendly .error-details-toggle {
  margin-top: var(--space-md);
}

.error-message-friendly .error-details-toggle summary {
  cursor: pointer;
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  user-select: none;
}

.error-message-friendly .error-technical {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
}

/* High Contrast for new components */
[data-high-contrast='true'] .param-search-input,
[data-high-contrast='true'] .param-jump-select {
  border-width: 3px;
}

[data-high-contrast='true'] .workflow-step-number {
  border-width: 3px;
}

[data-high-contrast='true'] .error-message-friendly {
  border-width: 3px;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .param-search-row {
    flex-direction: column;
  }

  .param-jump-wrapper {
    flex: 1 1 100%;
  }

  .workflow-progress {
    padding: var(--space-xs) var(--space-sm);
    gap: var(--space-sm);
  }

  .workflow-step-label {
    display: none;
  }

  .workflow-step-number {
    width: 32px;
    height: 32px;
    font-size: var(--font-size-base);
  }

  /* Compact workflow action buttons on mobile */
  .workflow-actions {
    gap: var(--space-xs);
  }

  .workflow-actions .btn-text {
    display: none;
  }

  .workflow-actions .btn {
    min-width: 32px;
    padding: var(--space-xs);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .workflow-step-number,
  .workflow-step-label {
    transition: none;
  }
}

@media (forced-colors: active) {
  /* Skip link must be visible */
  .skip-link {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText;
  }

  .skip-link:focus {
    outline: 3px solid Highlight;
    outline-offset: 2px;
    background: Highlight;
    color: HighlightText;
  }

  /* Button states */
  .btn,
  button {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  .btn:hover,
  button:hover {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  .btn:disabled,
  button:disabled {
    opacity: 1; /* Don't use opacity in forced-colors */
    color: GrayText;
    border-color: GrayText !important;
  }

  /* Drawer toggle buttons */
  .preview-drawer-toggle-btn,
  .actions-drawer-toggle {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  .preview-drawer-toggle-btn:hover,
  .preview-drawer-toggle-btn:focus,
  .actions-drawer-toggle:hover,
  .actions-drawer-toggle:focus {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  .drawer-toggle-handle {
    background: ButtonText !important;
  }

  .actions-toggle-arrow {
    color: ButtonText;
  }

  .actions-drawer-toggle:hover .actions-toggle-arrow {
    color: HighlightText;
  }

  /* Input fields */
  input,
  select,
  textarea {
    background: Field;
    color: FieldText;
    border: 2px solid ButtonText !important;
  }

  input:focus,
  select:focus,
  textarea:focus {
    outline: 3px solid Highlight;
    outline-offset: 2px;
  }

  /* Links must be distinguishable */
  a,
  .btn-link {
    color: LinkText;
    text-decoration: underline;
  }

  a:visited {
    color: VisitedText;
  }

  /* Focus indicators - use outline instead of box-shadow */
  *:focus,
  *:focus-visible {
    outline: 3px solid Highlight !important;
    outline-offset: 2px !important;
    box-shadow: none !important;
  }

  /* Upload zone */
  .upload-zone {
    border: 3px dashed ButtonText !important;
    background: Canvas;
  }

  .upload-zone:hover,
  .upload-zone:focus {
    border-color: Highlight !important;
    background: Canvas;
  }

  /* Tooltips */
  .param-tooltip {
    background: Canvas;
    color: CanvasText;
    border: 2px solid CanvasText !important;
  }

  .param-help-button {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  /* Toggle switch */
  .toggle-switch input[type='checkbox'] {
    background: Field;
    border: 2px solid ButtonText !important;
  }

  .toggle-switch input[type='checkbox']:checked {
    background: Highlight;
    border-color: Highlight !important;
  }

  .toggle-switch input[type='checkbox']::before {
    background: ButtonText;
  }

  .toggle-switch input[type='checkbox']:checked::before {
    background: HighlightText;
  }

  /* Range slider */
  .slider-container input[type='range'] {
    background: Field;
    border: 2px solid ButtonText;
  }

  /* Preview state indicators */
  .preview-state-indicator {
    background: Canvas;
    color: CanvasText;
    border: 2px solid CanvasText !important;
  }

  /* Modal overlays */
  .preset-modal,
  .modal {
    background: rgba(0, 0, 0, 0.8); /* Keep overlay darker */
  }

  .preset-modal-content,
  .modal-content {
    background: Canvas;
    color: CanvasText;
    border: 3px solid CanvasText !important;
  }

  /* Tutorial overlay - spotlight coachmarks */
  .tutorial-backdrop {
    fill: rgba(0, 0, 0, 0.9);
  }

  .tutorial-panel {
    border: 3px solid CanvasText !important;
    background: Canvas;
    color: CanvasText;
  }

  .tutorial-arrow {
    border-color: CanvasText !important;
    background: Canvas;
  }

  .tutorial-restore {
    background: Highlight;
    color: HighlightText;
    border: 2px solid HighlightText;
  }

  .tutorial-requirement {
    border-color: CanvasText;
    background: Canvas;
  }

  .tutorial-target-highlight {
    outline: 4px solid Highlight !important;
    animation: none !important;
  }

  /* Tutorial navigation buttons - critical for visibility in forced-colors */
  .tutorial-btn-back {
    background: ButtonFace !important;
    color: ButtonText !important;
    border: 2px solid ButtonText !important;
  }

  .tutorial-btn-next {
    background: Highlight !important;
    color: HighlightText !important;
    border: 2px solid HighlightText !important;
  }

  .tutorial-btn-back:disabled,
  .tutorial-btn-next:disabled {
    background: GrayText !important;
    color: Canvas !important;
    border-color: GrayText !important;
    opacity: 1 !important;
  }

  .tutorial-header,
  .tutorial-title,
  .tutorial-step-title {
    color: CanvasText;
  }

  .tutorial-content,
  .tutorial-step-content {
    color: CanvasText;
  }

  .tutorial-progress {
    color: CanvasText;
  }

  .tutorial-spotlight-cutout {
    stroke: Highlight;
    stroke-width: 3px;
  }

  /* File tree and code areas */
  .file-tree,
  .source-viewer-textarea,
  .params-json-textarea {
    background: Field;
    color: FieldText;
    border: 2px solid ButtonText !important;
  }

  /* Preset items */
  .preset-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Comparison view variant cards */
  .variant-card {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Library items */
  .library-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  .library-item:has(input:checked) {
    border-color: Highlight !important;
    background: Canvas;
  }

  /* Queue items */
  .queue-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Ensure all SVG icons use currentColor */
  svg,
  svg * {
    fill: currentColor !important;
    stroke: currentColor !important;
  }

  /* Color preview - show border in forced-colors */
  .color-preview,
  .color-picker {
    border: 3px solid ButtonText !important;
  }

  /* Status badges and indicators */
  .queue-badge,
  .library-badge,
  .file-tree-badge {
    background: Highlight;
    color: HighlightText;
    border: 2px solid Highlight !important;
  }

  /* Remove background-dependent visual effects */
  .spinner,
  .preview-state-indicator.state-pending,
  .preview-container.preview-rendering {
    animation: none !important;
  }

  /* Ensure progress bars are visible */
  .progress-bar {
    background: Field;
    border: 1px solid ButtonText;
  }

  .progress-fill {
    background: Highlight;
  }

  /* Details/summary elements */
  .param-group,
  .preset-controls,
  .preview-settings-panel,
  .library-details,
  .advanced-menu {
    border: 2px solid CanvasText !important;
  }

  /* Feature cards */
  .feature-card {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  /* Role path cards (Welcome screen) */
  .role-path-card {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  .role-path-card:focus-within {
    border: 3px solid Highlight !important;
    box-shadow: none;
  }

  .spotlight-link {
    border: 2px solid ButtonText !important;
    background: ButtonFace;
    color: ButtonText;
  }

  .spotlight-link:hover {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  /* Features guide tabs */
  .features-tab[aria-selected='true'] {
    border-bottom-color: Highlight !important;
    color: Highlight;
  }

  /* Parameter search */
  .param-search-section {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  .param-search-input,
  .param-jump-select {
    border: 2px solid ButtonText !important;
    background: Field;
    color: FieldText;
  }

  .param-search-clear {
    background: ButtonFace;
    color: ButtonText;
    border: 1px solid ButtonText !important;
  }

  /* Workflow progress */
  .workflow-progress {
    background: Canvas;
    border-bottom: 2px solid CanvasText !important;
  }

  .workflow-step-number {
    background: Canvas;
    border: 2px solid CanvasText !important;
    color: CanvasText;
  }

  .workflow-step.active .workflow-step-number {
    background: Highlight;
    border-color: Highlight !important;
    color: HighlightText;
  }

  .workflow-step.completed .workflow-step-number {
    background: ButtonFace;
    border-color: ButtonText !important;
    color: ButtonText;
  }

  /* Confirm modal */
  .confirm-modal-content {
    background: Canvas;
    border: 3px solid CanvasText !important;
  }

  /* Friendly error display */
  .error-message-friendly {
    background: Canvas;
    border: 3px solid CanvasText !important;
  }

  .error-technical {
    background: Field;
    color: FieldText;
    border: 1px solid CanvasText !important;
  }
}

/* Hidden feature animations */
@keyframes _hfm-flash {
  0%,
  100% {
    filter: none;
  }
  50% {
    filter: brightness(1.5) contrast(1.2);
  }
}

.preview-container._hfm-unlock {
  animation: _hfm-flash 0.3s ease-in-out;
}
